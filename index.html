<!doctype html>
<html lang="eu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Taula periodikoa — Euskera</title>
<!-- Añadir Three.js y OrbitControls -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
<style>
:root{
  --panel-width:360px; 
  --cell-size: 72px;
  --gap-size: 6px;
  --bg:#0a0a0a; /* Negro puro */
  --zoom-level: 0.75;
}

*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI, Roboto, Helvetica, Arial, sans-serif;background:var(--bg);color:#e6e6e6;overflow:hidden}
.app{display:flex;height:100vh;width:100vw}
/* left panel */
.panel{width:var(--panel-width);min-width:var(--panel-width);background:linear-gradient(180deg,#0a0a0a,#111111);padding:20px;border-right:1px solid rgba(58,121,94,0.3);overflow:auto;flex-shrink:0}

/* Título ONDDI AKADEMIA - SIMPLIFICADO */
.onddi-title {
  font-family: 'Arista 2.0 Alternate', sans-serif;
  font-size: 32px;
  font-weight: 700;
  color: #3A795E;
  text-align: center;
  margin: 0 0 25px 0;
  padding: 0;
  letter-spacing: 1px;
  width: 100%;
}

.panel h1{margin:0 0 8px 0;font-size:18px;color:#e6e6e6}
.panel p{margin:0 0 14px 0;opacity:0.8;color:#cccccc}
.card{background:linear-gradient(180deg,#111111,#0d0d0d);padding:14px;border-radius:8px;border:1px solid rgba(58,121,94,0.2)}
.big-square{width:84px;height:84px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:40px;margin-right:14px;color:#000 !important}
.info-head{display:flex;align-items:center;justify-content:space-between}
.info-left{display:flex;align-items:center}
.info-rows{margin-top:12px}
.info-rows div{margin:8px 0}
/* MODIFICADO: Aumentar el ancho de las etiquetas para que quepa "Ionizazio Energia" */
.info-rows b{display:inline-block;width:170px;color:#cccccc}
.small-muted{font-size:12px;opacity:0.8;color:#aaaaaa}
.footer{margin-top:12px;font-size:12px;opacity:0.7;color:#888888}

/* Leyenda para bloques electrónicos - MODIFICADA: Con botón de toggle integrado */
.elec-legend {
  background: rgba(58,121,94,0.08);
  border-radius: 8px;
  padding: 12px;
  margin: 10px 0;
  border: 1px solid rgba(58,121,94,0.2);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.elec-legend-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.elec-legend-title {
  font-size: 14px;
  font-weight: 600;
  color: #cccccc;
  margin: 0;
}

/* NUEVO: Pestaña retráctil para propiedades */
.properties-toggle {
  background: rgba(58,121,94,0.08);
  border-radius: 8px;
  padding: 12px;
  margin: 10px 0;
  border: 1px solid rgba(58,121,94,0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.properties-toggle:hover {
  background: rgba(58,121,94,0.12);
}

.properties-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.properties-title {
  font-size: 14px;
  font-weight: 600;
  color: #cccccc;
  margin: 0;
}

.properties-icon {
  transition: transform 0.3s ease;
  color: #3A795E;
  font-weight: bold;
}

.properties-toggle.active .properties-icon {
  transform: rotate(180deg);
}

.properties-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.properties-toggle.active .properties-content {
  max-height: 500px;
}

.properties-content-inner {
  padding-top: 12px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Leyenda para electronegatividad */
.electroneg-legend {
  background: rgba(58,121,94,0.08);
  border-radius: 8px;
  padding: 12px;
  border: 1px solid rgba(58,121,94,0.2);
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: relative;
}

.electroneg-legend-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.electroneg-legend-title {
  position: relative;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: help;
  font-size: 14px;
  font-weight: 600;
  color: #cccccc;
  margin: 0;
}

.title-tooltip {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: rgba(58,121,94,0.15);
  border: 1px solid rgba(58,121,94,0.3);
  color: #cccccc;
  font-size: 11px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: help;
  transition: all 0.2s ease;
}

.electroneg-legend-title:hover .title-tooltip {
  background: rgba(58,121,94,0.3);
  border-color: rgba(58,121,94,0.5);
  color: #e6e6e6;
  transform: scale(1.1);
}

.tooltip-content {
  position: absolute;
  top: 100%;
  left: 0;
  background: linear-gradient(180deg, #1a1a1a, #252525);
  border: 1px solid rgba(58,121,94,0.4);
  border-radius: 6px;
  padding: 8px 10px;
  font-size: 11px;
  line-height: 1.3;
  color: #e6e6e6;
  /* MODIFICADO: Ancho aumentado para que quepan los títulos en una línea */
  width: 200px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.5);
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-8px);
  transition: all 0.25s ease;
  pointer-events: none;
}

.electroneg-legend-title:hover .tooltip-content {
  opacity: 1;
  visibility: visible;
  transform: translateY(3px);
}

.tooltip-content strong {
  color: #98FB98;
  display: block;
  margin-bottom: 3px;
  font-size: 11px;
  /* MODIFICADO: Asegurar que el texto fuerte no se rompa */
  white-space: nowrap;
}

.electroneg-legend-gradient {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 8px;
  font-size: 11px;
  color: #cccccc;
}

.electroneg-gradient-bar {
  flex: 1;
  height: 20px;
  background: linear-gradient(90deg, #e6f3ff, #0066cc);
  border-radius: 4px;
  margin: 0 8px;
}

/* Leyenda para radio atómico */
.radius-legend {
  background: rgba(58,121,94,0.08);
  border-radius: 8px;
  padding: 12px;
  border: 1px solid rgba(58,121,94,0.2);
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: relative;
}

.radius-legend-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.radius-legend-title {
  position: relative;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: help;
  font-size: 14px;
  font-weight: 600;
  color: #cccccc;
  margin: 0;
}

.radius-legend-title:hover .title-tooltip {
  background: rgba(58,121,94,0.3);
  border-color: rgba(58,121,94,0.5);
  color: #e6e6e6;
  transform: scale(1.1);
}

.radius-legend-title:hover .tooltip-content {
  opacity: 1;
  visibility: visible;
  transform: translateY(3px);
}

.radius-legend-gradient {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 8px;
  font-size: 11px;
  color: #cccccc;
}

.radius-gradient-bar {
  flex: 1;
  height: 20px;
  background: linear-gradient(90deg, #e8f5e8, #1a4d2a);
  border-radius: 4px;
  margin: 0 8px;
}

/* NUEVO: Leyenda para Ionizazio Energia */
.ionization-legend {
  background: rgba(58,121,94,0.08);
  border-radius: 8px;
  padding: 12px;
  border: 1px solid rgba(58,121,94,0.2);
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: relative;
}

.ionization-legend-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.ionization-legend-title {
  position: relative;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: help;
  font-size: 14px;
  font-weight: 600;
  color: #cccccc;
  margin: 0;
}

.ionization-legend-title:hover .title-tooltip {
  background: rgba(58,121,94,0.3);
  border-color: rgba(58,121,94,0.5);
  color: #e6e6e6;
  transform: scale(1.1);
}

.ionization-legend-title:hover .tooltip-content {
  opacity: 1;
  visibility: visible;
  transform: translateY(3px);
}

.ionization-legend-gradient {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 8px;
  font-size: 11px;
  color: #cccccc;
}

.ionization-gradient-bar {
  flex: 1;
  height: 20px;
  background: linear-gradient(90deg, #ffe6e6, #cc0000);
  border-radius: 4px;
  margin: 0 8px;
}

/* Botón de toggle */
.elec-toggle-btn, .radius-toggle-btn, .electroneg-toggle-btn, .ionization-toggle-btn {
  width: 44px;
  height: 24px;
  background: rgba(58,121,94,0.3);
  border-radius: 12px;
  border: none;
  position: relative;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
}

.elec-toggle-btn::before, .radius-toggle-btn::before, .electroneg-toggle-btn::before, .ionization-toggle-btn::before {
  content: '';
  position: absolute;
  width: 18px;
  height: 18px;
  background: #e6e6e6;
  border-radius: 50%;
  top: 3px;
  left: 3px;
  transition: all 0.3s ease;
}

.elec-toggle-btn.active, .radius-toggle-btn.active, .electroneg-toggle-btn.active, .ionization-toggle-btn.active {
  background: #3A795E;
}

.elec-toggle-btn.active::before, .radius-toggle-btn.active::before, .electroneg-toggle-btn.active::before, .ionization-toggle-btn.active::before {
  transform: translateX(20px);
}

.elec-legend-items {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.elec-legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 8px;
  font-size: 14px;
  font-weight: 600;
  color: #cccccc;
  transition: all 0.3s ease;
}

/* Estados de la leyenda */
.elec-legend:not(.active) .elec-legend-color {
  opacity: 0.4;
  filter: grayscale(0.7);
}

.elec-legend:not(.active) .elec-legend-item span {
  opacity: 0.6;
}

.elec-legend.active .elec-legend-color {
  opacity: 1;
  filter: none;
}

.elec-legend.active .elec-legend-item span {
  opacity: 1;
}

.electroneg-legend:not(.active) .electroneg-gradient-bar {
  opacity: 0.4;
  filter: grayscale(0.7);
}

.electroneg-legend:not(.active) .electroneg-legend-gradient span {
  opacity: 0.6;
}

.electroneg-legend.active .electroneg-gradient-bar {
  opacity: 1;
  filter: none;
}

.electroneg-legend.active .electroneg-legend-gradient span {
  opacity: 1;
}

.radius-legend:not(.active) .radius-gradient-bar {
  opacity: 0.4;
  filter: grayscale(0.7);
}

.radius-legend:not(.active) .radius-legend-gradient span {
  opacity: 0.6;
}

.radius-legend.active .radius-gradient-bar {
  opacity: 1;
  filter: none;
}

.radius-legend.active .radius-legend-gradient span {
  opacity: 1;
}

.ionization-legend:not(.active) .ionization-gradient-bar {
  opacity: 0.4;
  filter: grayscale(0.7);
}

.ionization-legend:not(.active) .ionization-legend-gradient span {
  opacity: 0.6;
}

.ionization-legend.active .ionization-gradient-bar {
  opacity: 1;
  filter: none;
}

.ionization-legend.active .ionization-legend-gradient span {
  opacity: 1;
}

.elec-legend-color {
  width: 20px;
  height: 20px;
  border-radius: 4px;
  min-width: 20px;
  transition: all 0.3s ease;
}

/* Colores pastel para bloques electrónicos MEJORADOS */
.s-block { background: #FFB6C1 !important; color: #333; } /* Rosa pastel */
.p-block { background: #B19CD9 !important; color: #333; } /* Lila pastel */
.d-block { background: #87CEEB !important; color: #333; } /* Azul cielo */
.f-block { background: #FFDAC1 !important; color: #333; } /* Naranja pastel */

/* Clase para radio atómico */
.atomic-radius { 
  color: #333 !important; 
  transition: all 0.3s ease;
}

/* Clase para electronegatividad */
.electronegativity { 
  color: #333 !important; 
  transition: all 0.3s ease;
}

/* NUEVO: Clase para ionizazio energia */
.ionization-energy { 
  color: #333 !important; 
  transition: all 0.3s ease;
}

/* NUEVO: Estilo para elementos con radio desconocido (difuminados) */
.cell.unknown-radius {
  opacity: 0.4;
  filter: grayscale(0.8) blur(0.5px);
  transform: scale(0.95);
}

.cell.unknown-radius:hover {
  opacity: 0.6;
  filter: grayscale(0.6) blur(0.3px);
  transform: translateY(-2px) scale(1.02);
}

/* NUEVO: Estilo para elementos con electronegatividad desconocida */
.cell.unknown-electroneg {
  opacity: 0.4;
  filter: grayscale(0.8) blur(0.5px);
  transform: scale(0.95);
}

.cell.unknown-electroneg:hover {
  opacity: 0.6;
  filter: grayscale(0.6) blur(0.3px);
  transform: translateY(-2px) scale(1.02);
}

/* NUEVO: Estilo para elementos con ionizazio energia desconocida */
.cell.unknown-ionization {
  opacity: 0.4;
  filter: grayscale(0.8) blur(0.5px);
  transform: scale(0.95);
}

.cell.unknown-ionization:hover {
  opacity: 0.6;
  filter: grayscale(0.6) blur(0.3px);
  transform: translateY(-2px) scale(1.02);
}

/* NUEVO: Flechas de tendencia del radio atómico */
.trend-arrows {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 50;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.trend-arrows.active {
  opacity: 1;
}

.trend-arrow {
  position: absolute;
  font-size: 24px;
  font-weight: bold;
  text-shadow: 0 0 10px rgba(152, 251, 152, 0.7);
  animation: pulse 2s infinite;
}

.trend-arrow.radius {
  color: #98FB98;
}

.trend-arrow.electroneg {
  color: #87CEEB;
}

.trend-arrow.ionization {
  color: #FF6B6B;
  text-shadow: 0 0 10px rgba(255, 107, 107, 0.7);
}

.trend-arrow.down {
  transform: rotate(0deg);
}

.trend-arrow.up {
  transform: rotate(180deg);
}

.trend-arrow.left {
  transform: rotate(-90deg);
}

.trend-arrow.right {
  transform: rotate(90deg);
}

.trend-label {
  position: absolute;
  color: #98FB98;
  font-size: 12px;
  font-weight: bold;
  background: rgba(0, 0, 0, 0.7);
  padding: 2px 6px;
  border-radius: 4px;
  white-space: nowrap;
}

@keyframes pulse {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; }
}

/* Search Bar - MÁS ANCHO */
.search-container {
  margin-bottom: 20px;
  padding: 0 16px;
  width: 100%;
  max-width: 800px;
}

.search-box {
  width: 100%;
  padding: 14px 18px;
  background: linear-gradient(180deg,#111111,#0d0d0d);
  border: 1px solid rgba(58,121,94,0.3);
  border-radius: 10px;
  color: #e6e6e6;
  font-size: 16px;
  outline: none;
  transition: all 0.3s ease;
}

.search-box:focus {
  border-color: rgba(58,121,94,0.6);
  box-shadow: 0 0 15px rgba(58,121,94,0.3);
  transform: translateY(-2px);
}

.search-box::placeholder {
  color: rgba(204,204,204,0.6);
  font-size: 15px;
}

/* Groups and Periods Labels - CORREGIDO: Alineación mejorada */
.groups-container {
  display: grid;
  grid-template-columns: repeat(18, var(--cell-size));
  gap: var(--gap-size);
  margin-bottom: 10px;
  padding: 0 20px;
  margin-left: 44px;
}

.group-label {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 600;
  color: rgba(204,204,204,0.8);
  background: rgba(58,121,94,0.1);
  border-radius: 4px;
  padding: 4px;
  min-height: 30px;
  transition: all 0.3s ease;
}

.group-label.highlighted {
  background: rgba(58,121,94,0.3);
  color: #e6e6e6;
  box-shadow: 0 0 10px rgba(58,121,94,0.5);
  transform: scale(1.05);
}

.period-label {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 600;
  color: rgba(204,204,204,0.8);
  background: rgba(58,121,94,0.1);
  border-radius: 4px;
  padding: 4px;
  min-width: 30px;
  height: var(--cell-size);
  transition: all 0.3s ease;
}

.period-label.highlighted {
  background: rgba(58,121,94,0.3);
  color: #e6e6e6;
  box-shadow: 0 0 10px rgba(58,121,94,0.5);
  transform: scale(1.05);
}

.table-with-periods {
  display: grid;
  grid-template-columns: 30px 1fr;
  gap: var(--gap-size);
  padding: 0 14px;
}

.periods-column {
  display: grid;
  grid-template-rows: repeat(7, var(--cell-size));
  gap: var(--gap-size);
  margin-top: 14px;
}

/* Zoom Controls */
.zoom-controls {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(17,17,17,0.9);
  border-radius: 8px;
  padding: 10px;
  display: flex;
  gap: 8px;
  z-index: 1000;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(58,121,94,0.3);
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

.zoom-btn {
  background: rgba(58,121,94,0.2);
  border: none;
  color: #e6e6e6;
  width: 36px;
  height: 36px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 18px;
  font-weight: bold;
  transition: all 0.2s ease;
}

.zoom-btn:hover {
  background: rgba(58,121,94,0.4);
  transform: scale(1.05);
}

.zoom-display {
  color: #e6e6e6;
  font-size: 14px;
  display: flex;
  align-items: center;
  padding: 0 8px;
  min-width: 60px;
  justify-content: center;
  font-weight: 600;
}

/* table area */
.container{
  flex: 1;
  padding: 16px;
  display: flex;
  flex-direction: column;
  overflow: auto;
  min-width: 0;
  align-items: flex-start;
  justify-content: flex-start;
}

.table-complete-wrapper {
  transform: scale(var(--zoom-level));
  transform-origin: top left;
  transition: transform 0.3s ease;
  min-width: calc((var(--cell-size) * 18) + (var(--gap-size) * 17) + 28px + 30px);
  display: flex;
  flex-direction: column;
  gap: 10px;
  position: relative;
}

.periodic{
  display:grid;
  grid-template-columns:repeat(18, var(--cell-size));
  grid-auto-rows:var(--cell-size);
  gap:var(--gap-size);
  background:linear-gradient(180deg,#111111,#151515);
  padding:14px;
  border-radius:8px;
  box-shadow:0 10px 30px rgba(0,0,0,0.8);
  border:1px solid rgba(58,121,94,0.2);
  position: relative;
}

/* CORREGIDO: Posición exacta para lantánidos y actínidos - SIN HUECO Y ELEMENTOS ALINEADOS */
.bottom-series-container {
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: 100%;
  align-items: flex-start;
  margin-left: 0;
  padding-left: 0;
}

.bottom-series{
  display:grid;
  grid-template-columns:repeat(15, var(--cell-size));
  grid-auto-rows:var(--cell-size);
  gap:var(--gap-size);
  background:linear-gradient(180deg,#111111,#151515);
  padding:14px;
  border-radius:8px;
  box-shadow:0 10px 30px rgba(0,0,0,0.8);
  border:1px solid rgba(58,121,94,0.2);
  /* Posición exacta donde empieza la columna 3 de la tabla principal */
  margin-left: calc(44px + 8px + (var(--cell-size) * 2) + (var(--gap-size) * 2));
  width: calc((var(--cell-size) * 15) + (var(--gap-size) * 14) + 28px);
}

.cell{
  background:rgba(30,30,30,0.8);
  border-radius:6px;
  padding:6px;
  color:#e6e6e6;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  font-size:12px;
  border:1px solid rgba(58,121,94,0.1);
  cursor:pointer;
  transition:all 0.3s ease;
  width:var(--cell-size);
  height:var(--cell-size);
  box-sizing:border-box;
}
.cell .num{font-size:11px;opacity:0.85}
.cell .sym{
  font-size:26px;
  font-weight:400;
  line-height:1;
  letter-spacing:-0.02em;
  margin:0;
  display:block;
  text-align:center;
}
.cell .ename{
  font-size:11px;
  opacity:0.95;
  line-height:1.05;
  margin-top:3px;
  font-weight:600;
  font-stretch:condensed;
  letter-spacing:-0.02em;
  text-align:center;
}
.cell:hover{
  transform:translateY(-4px) scale(1.05);
  box-shadow:0 8px 24px rgba(58,121,94,0.4);
  border-color:rgba(58,121,94,0.3);
}
.cell.dimmed{opacity:0.3;transform:scale(0.95);filter:grayscale(0.7)}
.cell.highlighted{
  transform:scale(1.05);
  box-shadow:0 0 20px rgba(58,121,94,0.5);
  z-index:10;
  border-color:rgba(58,121,94,0.4);
}
.cell.search-match{
  transform:scale(1.08);
  box-shadow:0 0 25px rgba(58,121,94,0.7);
  z-index:20;
  border:2px solid #3A795E;
}
.cell.search-nomatch{opacity:0.2;filter:grayscale(0.8);transform:scale(0.9)}
.placeholder-cell{
  background:transparent;
  border:2px dashed rgba(58,121,94,0.3);
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:rgba(204,204,204,0.6);
  font-size:14px;
  font-weight:600;
  width:var(--cell-size);
  height:var(--cell-size);
  box-sizing:border-box;
}
/* categories colors - PASTEL VERSION */
.alkali{background:#FFB6C1;color:#333}
.alkaline{background:#FFD8B1;color:#333}
.lanthanide{background:#C9E4DE;color:#333}
.actinide{background:#D8BFD8;color:#333}
.transition{background:#B0E0E6;color:#333}
.post-transition{background:#E6E6FA;color:#333}
.metalloid{background:#98FB98;color:#333}
.nonmetal{background:#F0E68C;color:#333}
.halogen{background:#FFDEAD;color:#333}
.noble{background:#DDA0DD;color:#333}
.other{background:#F5F5F5;color:#333}

/* table legend */
.table-legend{
  grid-column:3 / span 10;
  grid-row:2 / span 2;
  display:grid;
  grid-template-columns:repeat(5,1fr);
  grid-template-rows:repeat(2,1fr);
  gap:6px;
  padding:10px;
  background:rgba(58,121,94,0.08);
  border-radius:6px;
  border:1px solid rgba(58,121,94,0.2);
  font-size:13px;
}
.table-legend-item{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px;
  cursor:pointer;
  border-radius:4px;
  transition:all 0.3s ease;
  font-size:13px;
  color:#cccccc;
}
.table-legend-item:hover{
  background:rgba(58,121,94,0.15);
  transform:translateY(-1px);
}
.table-legend-item.active{
  background:rgba(58,121,94,0.2);
  box-shadow:0 0 10px rgba(58,121,94,0.3);
}
.table-legend-item .sw{
  width:16px;
  height:16px;
  border-radius:3px;
  min-width:16px;
}

/* NUEVO: Botón 3D */
.btn-3d {
  background: #0a0a0a !important;
  border: 2px solid #3A795E !important;
  color: #3A795E !important;
  padding: 10px 16px !important;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin: 15px auto !important; /* Cambiado: auto en los lados para centrar */
  width: auto !important;
  min-width: 140px;
  box-shadow: 0 2px 8px rgba(58,121,94,0.2);
}

.btn-3d:hover {
  background: #3A795E !important; /* Fondo verde al hover */
  color: #0a0a0a !important; /* Texto negro al hover */
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(58,121,94,0.4);
}

.btn-3d:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px rgba(58,121,94,0.3);
}

/* NUEVO: Estilos para la ventana 3D */
.modal-3d {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  z-index: 2000;
  backdrop-filter: blur(5px);
}

.modal-3d.active {
  display: flex;
}

.modal-3d-content {
  width: 95%;
  height: 95%;
  background: linear-gradient(180deg, #111111, #151515);
  border-radius: 12px;
  margin: auto;
  display: flex;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(58,121,94,0.3);
}

.modal-3d-sidebar {
  width: 220px;
  background: linear-gradient(180deg, #0d0d0d, #111111);
  border-right: 1px solid rgba(58,121,94,0.2);
  padding: 20px;
  overflow-y: auto;
}

.modal-3d-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
}

.modal-3d-header {
  padding: 15px 20px;
  border-bottom: 1px solid rgba(58,121,94,0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(17,17,17,0.9);
}

.modal-3d-title {
  font-size: 20px;
  font-weight: 600;
  color: #e6e6e6;
  margin: 0;
}

.modal-3d-close {
  background: rgba(58,121,94,0.2);
  border: none;
  color: #e6e6e6;
  width: 36px;
  height: 36px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 18px;
  transition: all 0.2s ease;
}

.modal-3d-close:hover {
  background: rgba(58,121,94,0.4);
  transform: scale(1.05);
}

.modal-3d-viewer {
  flex: 1;
  background: #0a0a0a;
  position: relative;
  overflow: hidden;
}

.modal-3d-canvas {
  width: 100%;
  height: 100%;
  display: block;
}

.modal-3d-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 10px;
  background: rgba(17,17,17,0.8);
  padding: 10px;
  border-radius: 8px;
  border: 1px solid rgba(58,121,94,0.2);
}

.modal-3d-control-btn {
  background: rgba(58,121,94,0.2);
  border: none;
  color: #e6e6e6;
  width: 36px;
  height: 36px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s ease;
}

.modal-3d-control-btn:hover {
  background: rgba(58,121,94,0.4);
  transform: scale(1.05);
}

/* NUEVO: Estilos para menús retráctiles en el panel 3D */
.modal-3d-category {
  margin-bottom: 8px;
  border-radius: 6px;
  overflow: hidden;
  border: 1px solid rgba(58,121,94,0.2);
  transition: all 0.3s ease;
}

.modal-3d-category-header {
  background: rgba(58,121,94,0.1);
  padding: 12px 16px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
}

.modal-3d-category-header:hover {
  background: rgba(58,121,94,0.15);
}

.modal-3d-category-title {
  font-size: 16px;
  font-weight: 600;
  color: #3A795E;
  margin: 0;
}

.modal-3d-category-icon {
  color: #3A795E;
  font-weight: bold;
  transition: transform 0.3s ease;
}

.modal-3d-category.active .modal-3d-category-icon {
  transform: rotate(180deg);
}

.modal-3d-orbital-list {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
  background: rgba(17,17,17,0.5);
}

.modal-3d-category.active .modal-3d-orbital-list {
  max-height: 500px;
}

.modal-3d-orbital-btn {
  background: transparent;
  border: none;
  color: #cccccc;
  padding: 10px 16px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: left;
  width: 100%;
  border-bottom: 1px solid rgba(58,121,94,0.1);
}

.modal-3d-orbital-btn:last-child {
  border-bottom: none;
}

.modal-3d-orbital-btn:hover {
  background: rgba(58,121,94,0.1);
  color: #e6e6e6;
  padding-left: 20px;
}

.modal-3d-orbital-btn.active {
  background: rgba(58,121,94,0.2);
  color: #e6e6e6;
  box-shadow: inset 0 0 10px rgba(58,121,94,0.3);
}

.modal-3d-loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #e6e6e6;
  font-size: 18px;
  text-align: center;
}

.modal-3d-info {
  position: absolute;
  top: 20px;
  left: 20px;
  background: rgba(17,17,17,0.8);
  padding: 12px 16px;
  border-radius: 8px;
  border: 1px solid rgba(58,121,94,0.2);
  max-width: 300px;
}

.modal-3d-info-title {
  font-size: 16px;
  font-weight: 600;
  color: #3A795E;
  margin: 0 0 8px 0;
}

.modal-3d-info-desc {
  font-size: 14px;
  color: #cccccc;
  margin: 0;
  line-height: 1.4;
}

/* Scroll personalizado para contenedores */
.container::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.container::-webkit-scrollbar-track {
  background: rgba(58,121,94,0.1);
  border-radius: 4px;
}

.container::-webkit-scrollbar-thumb {
  background: rgba(58,121,94,0.3);
  border-radius: 4px;
}

.container::-webkit-scrollbar-thumb:hover {
  background: rgba(58,121,94,0.5);
}

/* El resto del CSS responsive permanece igual... */
</style>
</head>
<body>
<div class="app">
  <aside class="panel">
    <!-- Título ONDDI AKADEMIA - SIMPLIFICADO -->
    <div class="onddi-title">ONDDI AKADEMIA</div>
    
    <h1>Taula periodikoa — Informazioa</h1>
    <p>Hautatu elementu bat taulan klik eginez.</p>

    <!-- NUEVO: Botón 3D -->
    <button class="btn-3d" id="btn3D">
      <span>3D Orbitalak</span>
    </button>

    <!-- Leyenda para bloques electrónicos - MODIFICADA: Con botón de toggle integrado -->
    <div class="elec-legend" id="elecLegend">
      <div class="elec-legend-header">
        <div class="elec-legend-title">Orbital atomikoak</div>
        <button class="elec-toggle-btn" id="elecToggleBtn"></button>
      </div>
      <div class="elec-legend-items">
        <div class="elec-legend-item">
          <div class="elec-legend-color" style="background: #FFB6C1"></div>
          <span>s</span>
        </div>
        <div class="elec-legend-item">
          <div class="elec-legend-color" style="background: #B19CD9"></div>
          <span>p</span>
        </div>
        <div class="elec-legend-item">
          <div class="elec-legend-color" style="background: #87CEEB"></div>
          <span>d</span>
        </div>
        <div class="elec-legend-item">
          <div class="elec-legend-color" style="background: #FFDAC1"></div>
          <span>f</span>
        </div>
      </div>
    </div>

    <!-- NUEVO: Pestaña retráctil para propiedades -->
    <div class="properties-toggle" id="propertiesToggle">
      <div class="properties-header">
        <div class="properties-title">Propietateak</div>
        <div class="properties-icon">▼</div>
      </div>
      <div class="properties-content">
        <div class="properties-content-inner">
          <!-- Leyenda para electronegatividad -->
          <div class="electroneg-legend" id="electronegLegend">
            <div class="electroneg-legend-header">
              <div class="electroneg-legend-title">
                Elektronegatibitatea
                <div class="title-tooltip">?</div>
                <div class="tooltip-content">
                  <strong>Elektronegatibitatearen joera</strong><br>
                  Gezien norantzan handitu
                </div>
              </div>
              <button class="electroneg-toggle-btn" id="electronegToggleBtn"></button>
            </div>
            <div class="electroneg-legend-gradient">
              <span>Txikia</span>
              <div class="electroneg-gradient-bar"></div>
              <span>Handia</span>
            </div>
          </div>

          <!-- Leyenda para radio atómico -->
          <div class="radius-legend" id="radiusLegend">
            <div class="radius-legend-header">
              <div class="radius-legend-title">
                Erradio atomikoak
                <div class="title-tooltip">?</div>
                <div class="tooltip-content">
                  <strong>Erradioaren joera</strong><br>
                  Gezien norantzan handitu
                </div>
              </div>
              <button class="radius-toggle-btn" id="radiusToggleBtn"></button>
            </div>
            <div class="radius-legend-gradient">
              <span>Txikia</span>
              <div class="radius-gradient-bar"></div>
              <span>Handia</span>
            </div>
          </div>

          <!-- NUEVO: Leyenda para Ionizazio Energia -->
          <div class="ionization-legend" id="ionizationLegend">
            <div class="ionization-legend-header">
              <div class="ionization-legend-title">
                Ionizazio energia
                <div class="title-tooltip">?</div>
                <div class="tooltip-content">
                  <strong>Ionizazio energiaren joera</strong><br>
                  Gezien norantzan handitu
                </div>
              </div>
              <button class="ionization-toggle-btn" id="ionizationToggleBtn"></button>
            </div>
            <div class="ionization-legend-gradient">
              <span>Txikia</span>
              <div class="ionization-gradient-bar"></div>
              <span>Handia</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="info-head">
        <div class="info-left">
          <div id="iconSquare" class="big-square" style="background:#111111">—</div>
          <div>
            <div id="titleMain" style="font-size:20px;font-weight:700">Aukeratu elementu bat</div>
            <div id="subtitle" class="small-muted">Z = —</div>
          </div>
        </div>
      </div>

      <div class="info-rows">
        <div><b>Zenbaki atomikoa:</b> <span id="iz">—</span></div>
        <div><b>Masa molarra (u):</b> <span id="imass">—</span></div>
        <div><b>Balentziak:</b> <span id="ival">—</span></div>
        <div><b>Konfigurazio elektronikoa:</b> <span id="iconfig">—</span></div>
        <!-- Línea para electronegatividad -->
        <div><b>Elektronegatibitatea:</b> <span id="ielectroneg">—</span></div>
        <!-- Línea para el radio atómico -->
        <div><b>Erradio atomikoa (pm):</b> <span id="iradius">—</span></div>
        <!-- NUEVO: Línea para ionizazio energia -->
        <div><b>Ionizazio energia (kJ/mol):</b> <span id="iionization">—</span></div>
      </div>

      <div class="footer">Taula periodikoko datu orokorrak.</div>
    </div>
  </aside>

  <main class="container">
    <!-- Search Bar - MÁS ANCHO -->
    <div class="search-container">
      <input type="text" class="search-box" id="searchInput" placeholder="Bilatu elementua... (izenaz, sinboloaz edo zenbaki atomikoaz)">
    </div>

    <div class="table-complete-wrapper">
      <!-- NUEVO: Contenedor para flechas de tendencia -->
      <div class="trend-arrows" id="trendArrows">
        <!-- Flechas para radio atómico (verdes) -->
        <!-- Flecha vertical (H → Fr) - CORREGIDA: Desde H hasta Fr -->
        <div class="trend-arrow radius down" style="left: 40px; top: 40px;">↓</div>
        <div class="trend-arrow radius down" style="left: 40px; top: 120px;">↓</div>
        <div class="trend-arrow radius down" style="left: 40px; top: 200px;">↓</div>
        <div class="trend-arrow radius down" style="left: 40px; top: 280px;">↓</div>
        <div class="trend-arrow radius down" style="left: 40px; top: 360px;">↓</div>
        <div class="trend-arrow radius down" style="left: 40px; top: 440px;">↓</div>
        <div class="trend-arrow radius down" style="left: 40px; top: 520px;">↓</div>
        <!-- Flecha vertical adicional -->
        <div class="trend-arrow radius down" style="left: 40px; top: 600px;">↓</div>
        
        <!-- Flecha horizontal (He → H) - CORREGIDA: Desde He hasta H, ahora apuntando hacia la izquierda -->
        <!-- Comienzan más a la derecha (400px en lugar de 200px) y subidas 8px -->
        <div class="trend-arrow radius right" style="left: 1400px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 1320px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 1240px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 1160px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 1080px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 1000px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 920px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 840px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 760px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 680px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 600px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 520px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 440px; top: 30px;">↓</div>
        <!-- Flechas horizontales adicionales con espaciado consistente -->
        <div class="trend-arrow radius right" style="left: 360px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 280px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 200px; top: 30px;">↓</div>
        <div class="trend-arrow radius right" style="left: 120px; top: 30px;">↓</div>
        
        <!-- Flechas para electronegatividad (azules) - CORREGIDAS: Dirección correcta -->
        <!-- Flecha vertical (Fr → F) - Aumenta hacia arriba -->
        <div class="trend-arrow electroneg up" style="left: 40px; top: 600px;">↓</div>
        <div class="trend-arrow electroneg up" style="left: 40px; top: 520px;">↓</div>
        <div class="trend-arrow electroneg up" style="left: 40px; top: 440px;">↓</div>
        <div class="trend-arrow electroneg up" style="left: 40px; top: 360px;">↓</div>
        <div class="trend-arrow electroneg up" style="left: 40px; top: 280px;">↓</div>
        <div class="trend-arrow electroneg up" style="left: 40px; top: 200px;">↓</div>
        <div class="trend-arrow electroneg up" style="left: 40px; top: 120px;">↓</div>
        <div class="trend-arrow electroneg up" style="left: 40px; top: 40px;">↓</div>
        
        <!-- Flecha horizontal (Fr → F) - Aumenta hacia la derecha -->
        <div class="trend-arrow electroneg left" style="left: 120px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 200px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 280px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 360px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 440px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 520px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 600px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 680px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 760px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 840px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 920px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 1000px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 1080px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 1160px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 1240px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 1320px; top: 30px;">↓</div>
        <div class="trend-arrow electroneg left" style="left: 1400px; top: 30px;">↓</div>
        
        <!-- NUEVO: Flechas para ionizazio energia (rojas) - Misma dirección que electronegatividad -->
        <!-- Flecha vertical (Fr → F) - Aumenta hacia arriba -->
        <div class="trend-arrow ionization up" style="left: 40px; top: 600px;">↓</div>
        <div class="trend-arrow ionization up" style="left: 40px; top: 520px;">↓</div>
        <div class="trend-arrow ionization up" style="left: 40px; top: 440px;">↓</div>
        <div class="trend-arrow ionization up" style="left: 40px; top: 360px;">↓</div>
        <div class="trend-arrow ionization up" style="left: 40px; top: 280px;">↓</div>
        <div class="trend-arrow ionization up" style="left: 40px; top: 200px;">↓</div>
        <div class="trend-arrow ionization up" style="left: 40px; top: 120px;">↓</div>
        <div class="trend-arrow ionization up" style="left: 40px; top: 40px;">↓</div>
        
        <!-- Flecha horizontal (Fr → F) - Aumenta hacia la derecha -->
        <div class="trend-arrow ionization left" style="left: 120px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 200px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 280px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 360px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 440px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 520px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 600px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 680px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 760px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 840px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 920px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 1000px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 1080px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 1160px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 1240px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 1320px; top: 30px;">↓</div>
        <div class="trend-arrow ionization left" style="left: 1400px; top: 30px;">↓</div>
      </div>

      <!-- Groups Labels -->
      <div class="groups-container">
        <div class="group-label">1</div>
        <div class="group-label">2</div>
        <div class="group-label">3</div>
        <div class="group-label">4</div>
        <div class="group-label">5</div>
        <div class="group-label">6</div>
        <div class="group-label">7</div>
        <div class="group-label">8</div>
        <div class="group-label">9</div>
        <div class="group-label">10</div>
        <div class="group-label">11</div>
        <div class="group-label">12</div>
        <div class="group-label">13</div>
        <div class="group-label">14</div>
        <div class="group-label">15</div>
        <div class="group-label">16</div>
        <div class="group-label">17</div>
        <div class="group-label">18</div>
      </div>

      <div class="table-with-periods">
        <!-- Periods Labels -->
        <div class="periods-column">
          <div class="period-label">1</div>
          <div class="period-label">2</div>
          <div class="period-label">3</div>
          <div class="period-label">4</div>
          <div class="period-label">5</div>
          <div class="period-label">6</div>
          <div class="period-label">7</div>
        </div>

        <!-- Main Table -->
        <div class="periodic" id="table"></div>
      </div>

      <div class="bottom-series-container">
        <div class="bottom-series" id="lanthanides"></div>
        <div class="bottom-series" id="actinides"></div>
      </div>
    </div>
  </main>
</div>

<!-- NUEVO: Ventana modal para visualización 3D con menús retráctiles -->
<div class="modal-3d" id="modal3D">
  <div class="modal-3d-content">
    <div class="modal-3d-sidebar">
      <!-- Categoría s con menú retráctil -->
      <div class="modal-3d-category" id="category-s">
        <div class="modal-3d-category-header">
          <h3 class="modal-3d-category-title">s Orbitala</h3>
          <div class="modal-3d-category-icon">▼</div>
        </div>
        <div class="modal-3d-orbital-list">
          <button class="modal-3d-orbital-btn" data-model="s">s Orbitala</button>
        </div>
      </div>
      
      <!-- Categoría p con menú retráctil -->
      <div class="modal-3d-category" id="category-p">
        <div class="modal-3d-category-header">
          <h3 class="modal-3d-category-title">p Orbitalak</h3>
          <div class="modal-3d-category-icon">▼</div>
        </div>
        <div class="modal-3d-orbital-list">
          <button class="modal-3d-orbital-btn" data-model="p">p Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="px">pₓ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="py">pᵧ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="pz">p₂ Orbitala</button>
        </div>
      </div>
      
      <!-- Categoría d con menú retráctil -->
      <div class="modal-3d-category" id="category-d">
        <div class="modal-3d-category-header">
          <h3 class="modal-3d-category-title">d Orbitalak</h3>
          <div class="modal-3d-category-icon">▼</div>
        </div>
        <div class="modal-3d-orbital-list">
          <button class="modal-3d-orbital-btn" data-model="dxy">dₓᵧ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="dx2y2">dₓ²₋ᵧ² Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="dyz">dᵧ₂ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="dzx">d₂ₓ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="dz2">d₂² Orbitala</button>
        </div>
      </div>
      
      <!-- Categoría f con menú retráctil -->
      <div class="modal-3d-category" id="category-f">
        <div class="modal-3d-category-header">
          <h3 class="modal-3d-category-title">f Orbitalak</h3>
          <div class="modal-3d-category-icon">▼</div>
        </div>
        <div class="modal-3d-orbital-list">
          <button class="modal-3d-orbital-btn" data-model="f1">f₁ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="f2">f₂ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="f3">f₃ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="f4">f₄ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="f5">f₅ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="f6">f₆ Orbitala</button>
          <button class="modal-3d-orbital-btn" data-model="f7">f₇ Orbitala</button>
        </div>
      </div>
    </div>
    <div class="modal-3d-main">
      <div class="modal-3d-header">
        <h2 class="modal-3d-title">Orbital Atomikoen Irudikapena</h2>
        <button class="modal-3d-close" id="modal3DClose">✕</button>
      </div>
      <div class="modal-3d-viewer">
        <canvas class="modal-3d-canvas" id="canvas3D"></canvas>
        <div class="modal-3d-loading" id="loading3D">Kargatzen...</div>
        <div class="modal-3d-info" id="info3D">
          <h3 class="modal-3d-info-title" id="infoTitle">Orbital atomikoak</h3>
          <p class="modal-3d-info-desc" id="infoDesc">Hautatu orbital bat menutik ikusteko.</p>
        </div>
        <div class="modal-3d-controls">
          <button class="modal-3d-control-btn" id="resetView">↺</button>
          <button class="modal-3d-control-btn" id="autoRotate">▶</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Controles de Zoom -->
<div class="zoom-controls">
  <button class="zoom-btn" id="zoomOut">−</button>
  <div class="zoom-display" id="zoomLevel">100%</div>
  <button class="zoom-btn" id="zoomIn">+</button>
  <button class="zoom-btn" id="zoomReset">↺</button>
</div>

<script>
// Elements dataset con electronegatividad, radio atómico y ionizazio energia añadidos
const elements = [
 {z:1,sym:'H',name:'Hidrogenoa',mass:1.008,val:[-1,1],config:'1s1',group:'nonmetal',x:1,y:1,radius:53,electroneg:2.20,ionization:1312},
 {z:2,sym:'He',name:'Helioa',mass:4.0026,val:[0],config:'1s2',group:'noble',x:18,y:1,radius:31,electroneg:0,ionization:2372},
 {z:3,sym:'Li',name:'Litioa',mass:6.94,val:[1],config:'[He] 2s1',group:'alkali',x:1,y:2,radius:167,electroneg:0.98,ionization:520},
 {z:4,sym:'Be',name:'Berilioa',mass:9.0122,val:[2],config:'[He] 2s2',group:'alkaline',x:2,y:2,radius:112,electroneg:1.57,ionization:899},
 {z:5,sym:'B',name:'Boroa',mass:10.81,val:[3],config:'[He] 2s2 2p1',group:'metalloid',x:13,y:2,radius:87,electroneg:2.04,ionization:801},
 {z:6,sym:'C',name:'Karbonoa',mass:12.011,val:[-4,2,4],config:'[He] 2s2 2p2',group:'nonmetal',x:14,y:2,radius:67,electroneg:2.55,ionization:1086},
 {z:7,sym:'N',name:'Nitrogenoa',mass:14.007,val:[-3,1,3,5],config:'[He] 2s2 2p3',group:'nonmetal',x:15,y:2,radius:56,electroneg:3.04,ionization:1402},
 {z:8,sym:'O',name:'Oxigenoa',mass:15.999,val:[-2,-1],config:'[He] 2s2 2p4',group:'nonmetal',x:16,y:2,radius:48,electroneg:3.44,ionization:1314},
 {z:9,sym:'F',name:'Fluorra',mass:18.998,val:[-1],config:'[He] 2s2 2p5',group:'halogen',x:17,y:2,radius:42,electroneg:3.98,ionization:1681},
 {z:10,sym:'Ne',name:'Neona',mass:20.180,val:[0],config:'[He] 2s2 2p6',group:'noble',x:18,y:2,radius:38,electroneg:0,ionization:2081},

 {z:11,sym:'Na',name:'Sodioa',mass:22.990,val:[1],config:'[Ne] 3s1',group:'alkali',x:1,y:3,radius:190,electroneg:0.93,ionization:496},
 {z:12,sym:'Mg',name:'Magnesioa',mass:24.305,val:[2],config:'[Ne] 3s2',group:'alkaline',x:2,y:3,radius:145,electroneg:1.31,ionization:738},
 {z:13,sym:'Al',name:'Aluminioa',mass:26.982,val:[3],config:'[Ne] 3s2 3p1',group:'post-transition',x:13,y:3,radius:118,electroneg:1.61,ionization:577},
 {z:14,sym:'Si',name:'Silizioa',mass:28.085,val:[-4,4],config:'[Ne] 3s2 3p2',group:'metalloid',x:14,y:3,radius:111,electroneg:1.90,ionization:786},
 {z:15,sym:'P',name:'Fosforoa',mass:30.974,val:[-3,3,5],config:'[Ne] 3s2 3p3',group:'nonmetal',x:15,y:3,radius:98,electroneg:2.19,ionization:1012},
 {z:16,sym:'S',name:'Sufrea',mass:32.06,val:[-2,2,4,6],config:'[Ne] 3s2 3p4',group:'nonmetal',x:16,y:3,radius:88,electroneg:2.58,ionization:1000},
 {z:17,sym:'Cl',name:'Kloroa',mass:35.45,val:[-1,1,3,5,7],config:'[Ne] 3s2 3p5',group:'halogen',x:17,y:3,radius:79,electroneg:3.16,ionization:1251},
 {z:18,sym:'Ar',name:'Argona',mass:39.948,val:[0],config:'[Ne] 3s2 3p6',group:'noble',x:18,y:3,radius:71,electroneg:0,ionization:1521},

 {z:19,sym:'K',name:'Potasioa',mass:39.098,val:[1],config:'[Ar] 4s1',group:'alkali',x:1,y:4,radius:243,electroneg:0.82,ionization:419},
 {z:20,sym:'Ca',name:'Kaltzioa',mass:40.078,val:[2],config:'[Ar] 4s2',group:'alkaline',x:2,y:4,radius:194,electroneg:1.00,ionization:590},
 {z:21,sym:'Sc',name:'Eskandioa',mass:44.956,val:[3],config:'[Ar] 3d1 4s2',group:'transition',x:3,y:4,radius:184,electroneg:1.36,ionization:631},
 {z:22,sym:'Ti',name:'Titanioa',mass:47.867,val:[2,3,4],config:'[Ar] 3d2 4s2',group:'transition',x:4,y:4,radius:176,electroneg:1.54,ionization:658},
 {z:23,sym:'V',name:'Banadioa',mass:50.942,val:[2,3,4,5],config:'[Ar] 3d3 4s2',group:'transition',x:5,y:4,radius:171,electroneg:1.63,ionization:650},
 {z:24,sym:'Cr',name:'Kromoa',mass:51.996,val:[2,3,6],config:'[Ar] 3d5 4s1',group:'transition',x:6,y:4,radius:166,electroneg:1.66,ionization:653},
 {z:25,sym:'Mn',name:'Manganesoa',mass:54.938,val:[2,3,4,6,7],config:'[Ar] 3d5 4s2',group:'transition',x:7,y:4,radius:161,electroneg:1.55,ionization:717},
 {z:26,sym:'Fe',name:'Burdina',mass:55.845,val:[2,3],config:'[Ar] 3d6 4s2',group:'transition',x:8,y:4,radius:156,electroneg:1.83,ionization:762},
 {z:27,sym:'Co',name:'Kobaltoa',mass:58.933,val:[2,3],config:'[Ar] 3d7 4s2',group:'transition',x:9,y:4,radius:152,electroneg:1.88,ionization:760},
 {z:28,sym:'Ni',name:'Nikela',mass:58.693,val:[2,3],config:'[Ar] 3d8 4s2',group:'transition',x:10,y:4,radius:149,electroneg:1.91,ionization:737},
 {z:29,sym:'Cu',name:'Kobrea',mass:63.546,val:[1,2],config:'[Ar] 3d10 4s1',group:'transition',x:11,y:4,radius:145,electroneg:1.90,ionization:745},
 {z:30,sym:'Zn',name:'Zinka',mass:65.38,val:[2],config:'[Ar] 3d10 4s2',group:'transition',x:12,y:4,radius:142,electroneg:1.65,ionization:906},
 {z:31,sym:'Ga',name:'Galioa',mass:69.723,val:[3],config:'[Ar] 3d10 4s2 4p1',group:'post-transition',x:13,y:4,radius:136,electroneg:1.81,ionization:579},
 {z:32,sym:'Ge',name:'Germanioa',mass:72.630,val:[4],config:'[Ar] 3d10 4s2 4p2',group:'metalloid',x:14,y:4,radius:125,electroneg:2.01,ionization:762},
 {z:33,sym:'As',name:'Artsenikoa',mass:74.922,val:[-3,3,5],config:'[Ar] 3d10 4s2 4p3',group:'metalloid',x:15,y:4,radius:114,electroneg:2.18,ionization:947},
 {z:34,sym:'Se',name:'Selenioa',mass:78.971,val:[-2,2,4,6],config:'[Ar] 3d10 4s2 4p4',group:'nonmetal',x:16,y:4,radius:103,electroneg:2.55,ionization:941},
 {z:35,sym:'Br',name:'Bromoa',mass:79.904,val:[-1,1,3,5,7],config:'[Ar] 3d10 4s2 4p5',group:'halogen',x:17,y:4,radius:94,electroneg:2.96,ionization:1140},
 {z:36,sym:'Kr',name:'Kriptona',mass:83.798,val:[0,2],config:'[Ar] 3d10 4s2 4p6',group:'noble',x:18,y:4,radius:88,electroneg:3.00,ionization:1351},

 {z:37,sym:'Rb',name:'Rubidioa',mass:85.468,val:[1],config:'[Kr] 5s1',group:'alkali',x:1,y:5,radius:265,electroneg:0.82,ionization:403},
 {z:38,sym:'Sr',name:'Estrontzioa',mass:87.62,val:[2],config:'[Kr] 5s2',group:'alkaline',x:2,y:5,radius:219,electroneg:0.95,ionization:549},
 {z:39,sym:'Y',name:'Itrioa',mass:88.906,val:[3],config:'[Kr] 4d1 5s2',group:'transition',x:3,y:5,radius:212,electroneg:1.22,ionization:600},
 {z:40,sym:'Zr',name:'Zirkonioa',mass:91.224,val:[4],config:'[Kr] 4d2 5s2',group:'transition',x:4,y:5,radius:206,electroneg:1.33,ionization:640},
 {z:41,sym:'Nb',name:'Niobioa',mass:92.906,val:[3,5],config:'[Kr] 4d4 5s1',group:'transition',x:5,y:5,radius:198,electroneg:1.6,ionization:652},
 {z:42,sym:'Mo',name:'Molibdenoa',mass:95.95,val:[2,3,4,5,6],config:'[Kr] 4d5 5s1',group:'transition',x:6,y:5,radius:190,electroneg:2.16,ionization:684},
 {z:43,sym:'Tc',name:'Teknezioa',mass:98,val:[4,7],config:'[Kr] 4d5 5s2',group:'transition',x:7,y:5,radius:183,electroneg:1.9,ionization:702},
 {z:44,sym:'Ru',name:'Rutenioa',mass:101.07,val:[3,4,6,8],config:'[Kr] 4d7 5s1',group:'transition',x:8,y:5,radius:178,electroneg:2.2,ionization:710},
 {z:45,sym:'Rh',name:'Rodioa',mass:102.91,val:[3,4],config:'[Kr] 4d8 5s1',group:'transition',x:9,y:5,radius:173,electroneg:2.28,ionization:720},
 {z:46,sym:'Pd',name:'Paladioa',mass:106.42,val:[2,4],config:'[Kr] 4d10',group:'transition',x:10,y:5,radius:169,electroneg:2.20,ionization:804},
 {z:47,sym:'Ag',name:'Zilarra',mass:107.87,val:[1],config:'[Kr] 4d10 5s1',group:'transition',x:11,y:5,radius:165,electroneg:1.93,ionization:731},
 {z:48,sym:'Cd',name:'Kadmioa',mass:112.41,val:[2],config:'[Kr] 4d10 5s2',group:'transition',x:12,y:5,radius:161,electroneg:1.69,ionization:867},
 {z:49,sym:'In',name:'Indioa',mass:114.82,val:[3],config:'[Kr] 4d10 5s2 5p1',group:'post-transition',x:13,y:5,radius:156,electroneg:1.78,ionization:558},
 {z:50,sym:'Sn',name:'Eztainua',mass:118.71,val:[2,4],config:'[Kr] 4d10 5s2 5p2',group:'post-transition',x:14,y:5,radius:145,electroneg:1.96,ionization:709},
 {z:51,sym:'Sb',name:'Antimonioa',mass:121.76,val:[-3,3,5],config:'[Kr] 4d10 5s2 5p3',group:'metalloid',x:15,y:5,radius:133,electroneg:2.05,ionization:834},
 {z:52,sym:'Te',name:'Telurioa',mass:127.60,val:[-2,2,4,6],config:'[Kr] 4d10 5s2 5p4',group:'metalloid',x:16,y:5,radius:123,electroneg:2.1,ionization:869},
 {z:53,sym:'I',name:'Iodoa',mass:126.90,val:[-1,1,3,5,7],config:'[Kr] 4d10 5s2 5p5',group:'halogen',x:17,y:5,radius:115,electroneg:2.66,ionization:1008},
 {z:54,sym:'Xe',name:'Xenona',mass:131.29,val:[0,2,4,6,8],config:'[Kr] 4d10 5s2 5p6',group:'noble',x:18,y:5,radius:108,electroneg:2.6,ionization:1170},

 {z:55,sym:'Cs',name:'Zesioa',mass:132.91,val:[1],config:'[Xe] 6s1',group:'alkali',x:1,y:6,radius:298,electroneg:0.79,ionization:376},
 {z:56,sym:'Ba',name:'Barioa',mass:137.33,val:[2],config:'[Xe] 6s2',group:'alkaline',x:2,y:6,radius:253,electroneg:0.89,ionization:503},
 // Placeholder for lanthanides 57-71
 {z:72,sym:'Hf',name:'Hafnioa',mass:178.49,val:[4],config:'[Xe] 4f14 5d2 6s2',group:'transition',x:4,y:6,radius:208,electroneg:1.3,ionization:658},
 {z:73,sym:'Ta',name:'Tantaloa',mass:180.95,val:[5],config:'[Xe] 4f14 5d3 6s2',group:'transition',x:5,y:6,radius:200,electroneg:1.5,ionization:761},
 {z:74,sym:'W',name:'Wolframa',mass:183.84,val:[4,6],config:'[Xe] 4f14 5d4 6s2',group:'transition',x:6,y:6,radius:193,electroneg:2.36,ionization:770},
 {z:75,sym:'Re',name:'Renioa',mass:186.21,val:[-1,2,4,6,7],config:'[Xe] 4f14 5d5 6s2',group:'transition',x:7,y:6,radius:188,electroneg:1.9,ionization:760},
 {z:76,sym:'Os',name:'Osmioa',mass:190.23,val:[2,3,4,6,8],config:'[Xe] 4f14 5d6 6s2',group:'transition',x:8,y:6,radius:185,electroneg:2.2,ionization:840},
 {z:77,sym:'Ir',name:'Iridioa',mass:192.22,val:[3,4,6],config:'[Xe] 4f14 5d7 6s2',group:'transition',x:9,y:6,radius:180,electroneg:2.20,ionization:880},
 {z:78,sym:'Pt',name:'Platinoa',mass:195.08,val:[2,4],config:'[Xe] 4f14 5d9 6s1',group:'transition',x:10,y:6,radius:177,electroneg:2.28,ionization:870},
 {z:79,sym:'Au',name:'Urrea',mass:196.97,val:[1,3],config:'[Xe] 4f14 5d10 6s1',group:'transition',x:11,y:6,radius:174,electroneg:2.54,ionization:890},
 {z:80,sym:'Hg',name:'Merkurioa',mass:200.59,val:[1,2],config:'[Xe] 4f14 5d10 6s2',group:'transition',x:12,y:6,radius:171,electroneg:2.00,ionization:1007},
 {z:81,sym:'Tl',name:'Talioa',mass:204.38,val:[1,3],config:'[Xe] 4f14 5d10 6s2 6p1',group:'post-transition',x:13,y:6,radius:156,electroneg:1.62,ionization:589},
 {z:82,sym:'Pb',name:'Beruna',mass:207.2,val:[2,4],config:'[Xe] 4f14 5d10 6s2 6p2',group:'post-transition',x:14,y:6,radius:154,electroneg:1.87,ionization:716},
 {z:83,sym:'Bi',name:'Bismutoa',mass:208.98,val:[3,5],config:'[Xe] 4f14 5d10 6s2 6p3',group:'post-transition',x:15,y:6,radius:143,electroneg:2.02,ionization:703},
 {z:84,sym:'Po',name:'Polonioa',mass:209,val:[-2,2,4,6],config:'[Xe] 4f14 5d10 6s2 6p4',group:'metalloid',x:16,y:6,radius:135,electroneg:2.0,ionization:812},
 {z:85,sym:'At',name:'Astatoa',mass:210,val:[-1,1,3,5,7],config:'[Xe] 4f14 5d10 6s2 6p5',group:'halogen',x:17,y:6,radius:127,electroneg:2.2,ionization:930},
 {z:86,sym:'Rn',name:'Radona',mass:222,val:[0,2],config:'[Xe] 4f14 5d10 6s2 6p6',group:'noble',x:18,y:6,radius:120,electroneg:0,ionization:1037},

 {z:87,sym:'Fr',name:'Frantzioa',mass:223,val:[1],config:'[Rn] 7s1',group:'alkali',x:1,y:7,radius:0,electroneg:0.7,ionization:380},
 {z:88,sym:'Ra',name:'Radioa',mass:226,val:[2],config:'[Rn] 7s2',group:'alkaline',x:2,y:7,radius:0,electroneg:0.9,ionization:509},
 // Placeholder for actinides 89-103
 {z:104,sym:'Rf',name:'Rutherfordio',mass:267,val:[4],config:'[Rn] 5f14 6d2 7s2',group:'transition',x:4,y:7,radius:0,electroneg:0,ionization:580},
 {z:105,sym:'Db',name:'Dubnioa',mass:268,val:[5],config:'[Rn] 5f14 6d3 7s2',group:'transition',x:5,y:7,radius:0,electroneg:0,ionization:0},
 {z:106,sym:'Sg',name:'Seaborgioa',mass:271,val:[6],config:'[Rn] 5f14 6d4 7s2',group:'transition',x:6,y:7,radius:0,electroneg:0,ionization:0},
 {z:107,sym:'Bh',name:'Bohrioa',mass:270,val:[7],config:'[Rn] 5f14 6d5 7s2',group:'transition',x:7,y:7,radius:0,electroneg:0,ionization:0},
 {z:108,sym:'Hs',name:'Hassioa',mass:269,val:[6,8],config:'[Rn] 5f14 6d6 7s2',group:'transition',x:8,y:7,radius:0,electroneg:0,ionization:0},
 {z:109,sym:'Mt',name:'Meitnerioa',mass:278,val:[],config:'—',group:'transition',x:9,y:7,radius:0,electroneg:0,ionization:0},
 {z:110,sym:'Ds',name:'Darmstadtioa',mass:281,val:[],config:'—',group:'transition',x:10,y:7,radius:0,electroneg:0,ionization:0},
 {z:111,sym:'Rg',name:'Roentgenioa',mass:282,val:[],config:'—',group:'transition',x:11,y:7,radius:0,electroneg:0,ionization:0},
 {z:112,sym:'Cn',name:'Kopernizioa',mass:285,val:[],config:'[Rn] 5f14 6d10 7s2',group:'transition',x:12,y:7,radius:0,electroneg:0,ionization:0},
 {z:113,sym:'Nh',name:'Nihonioa',mass:286,val:[],config:'[Rn] 5f14 6d10 7s2 7p1',group:'post-transition',x:13,y:7,radius:0,electroneg:0,ionization:0},
 {z:114,sym:'Fl',name:'Flevorioa',mass:289,val:[],config:'—',group:'post-transition',x:14,y:7,radius:0,electroneg:0,ionization:0},
 {z:115,sym:'Mc',name:'Moskovioa',mass:289,val:[],config:'—',group:'post-transition',x:15,y:7,radius:0,electroneg:0,ionization:0},
 {z:116,sym:'Lv',name:'Livermorioa',mass:293,val:[],config:'—',group:'post-transition',x:16,y:7,radius:0,electroneg:0,ionization:0},
 {z:117,sym:'Ts',name:'Tenesoa',mass:294,val:[],config:'—',group:'halogen',x:17,y:7,radius:0,electroneg:0,ionization:0},
 {z:118,sym:'Og',name:'Oganesona',mass:294,val:[0],config:'—',group:'noble',x:18,y:7,radius:0,electroneg:0,ionization:0}
];

// Lanthanides and Actinides for bottom rows (including La and Ac) - MODIFICADO: Lantano y Actinio empiezan en grupo 3
const lanthanides = [
 {z:57,sym:'La',name:'Lantanoa',mass:138.91,val:[3],config:'[Xe] 5d1 6s2',group:'lanthanide',x:3,radius:187,electroneg:1.1,ionization:538},
 {z:58,sym:'Ce',name:'Zerioa',mass:140.12,val:[3,4],config:'[Xe] 4f1 5d1 6s2',group:'lanthanide',x:4,radius:181,electroneg:1.12,ionization:534},
 {z:59,sym:'Pr',name:'Praseodimio',mass:140.91,val:[3,4],config:'[Xe] 4f3 6s2',group:'lanthanide',x:5,radius:182,electroneg:1.13,ionization:527},
 {z:60,sym:'Nd',name:'Neodimioa',mass:144.24,val:[3],config:'[Xe] 4f4 6s2',group:'lanthanide',x:6,radius:181,electroneg:1.14,ionization:533},
 {z:61,sym:'Pm',name:'Prometioa',mass:145,val:[3],config:'[Xe] 4f5 6s2',group:'lanthanide',x:7,radius:183,electroneg:1.13,ionization:540},
 {z:62,sym:'Sm',name:'Samarioa',mass:150.36,val:[2,3],config:'[Xe] 4f6 6s2',group:'lanthanide',x:8,radius:180,electroneg:1.17,ionization:544},
 {z:63,sym:'Eu',name:'Europioa',mass:151.96,val:[2,3],config:'[Xe] 4f7 6s2',group:'lanthanide',x:9,radius:199,electroneg:1.2,ionization:547},
 {z:64,sym:'Gd',name:'Gadolinioa',mass:157.25,val:[3],config:'[Xe] 4f7 5d1 6s2',group:'lanthanide',x:10,radius:179,electroneg:1.2,ionization:593},
 {z:65,sym:'Tb',name:'Terbioa',mass:158.93,val:[3,4],config:'[Xe] 4f9 6s2',group:'lanthanide',x:11,radius:176,electroneg:1.2,ionization:565},
 {z:66,sym:'Dy',name:'Disprosioa',mass:162.50,val:[3],config:'[Xe] 4f10 6s2',group:'lanthanide',x:12,radius:175,electroneg:1.22,ionization:572},
 {z:67,sym:'Ho',name:'Holmioa',mass:164.93,val:[3],config:'[Xe] 4f11 6s2',group:'lanthanide',x:13,radius:174,electroneg:1.23,ionization:581},
 {z:68,sym:'Er',name:'Erbioa',mass:167.26,val:[3],config:'[Xe] 4f12 6s2',group:'lanthanide',x:14,radius:173,electroneg:1.24,ionization:589},
 {z:69,sym:'Tm',name:'Tulioa',mass:168.93,val:[2,3],config:'[Xe] 4f13 6s2',group:'lanthanide',x:15,radius:172,electroneg:1.25,ionization:596},
 {z:70,sym:'Yb',name:'Iterbioa',mass:173.05,val:[2,3],config:'[Xe] 4f14 6s2',group:'lanthanide',x:16,radius:194,electroneg:1.1,ionization:603},
 {z:71,sym:'Lu',name:'Lutezioa',mass:174.97,val:[3],config:'[Xe] 4f14 5d1 6s2',group:'lanthanide',x:17,radius:172,electroneg:1.27,ionization:524}
];

const actinides = [
 {z:89,sym:'Ac',name:'Aktinioa',mass:227,val:[3],config:'[Rn] 6d1 7s2',group:'actinide',x:3,radius:188,electroneg:1.1,ionization:499},
 {z:90,sym:'Th',name:'Torioa',mass:232.04,val:[4],config:'[Rn] 6d2 7s2',group:'actinide',x:4,radius:179,electroneg:1.3,ionization:587},
 {z:91,sym:'Pa',name:'Protaktinio',mass:231.04,val:[4,5],config:'[Rn] 5f2 6d1 7s2',group:'actinide',x:5,radius:163,electroneg:1.5,ionization:568},
 {z:92,sym:'U',name:'Uranioa',mass:238.03,val:[3,4,5,6],config:'[Rn] 5f3 6d1 7s2',group:'actinide',x:6,radius:156,electroneg:1.38,ionization:597},
 {z:93,sym:'Np',name:'Neptunioa',mass:237,val:[3,4,5,6,7],config:'[Rn] 5f4 6d1 7s2',group:'actinide',x:7,radius:155,electroneg:1.36,ionization:604},
 {z:94,sym:'Pu',name:'Plutonioa',mass:244,val:[3,4,5,6,7],config:'[Rn] 5f6 7s2',group:'actinide',x:8,radius:159,electroneg:1.28,ionization:584},
 {z:95,sym:'Am',name:'Amerizioa',mass:243,val:[3,4,5,6],config:'[Rn] 5f7 7s2',group:'actinide',x:9,radius:173,electroneg:1.13,ionization:578},
 {z:96,sym:'Cm',name:'Kurioa',mass:247,val:[3,4],config:'[Rn] 5f7 6d1 7s2',group:'actinide',x:10,radius:174,electroneg:1.28,ionization:581},
 {z:97,sym:'Bk',name:'Berkelioa',mass:247,val:[3,4],config:'[Rn] 5f9 7s2',group:'actinide',x:11,radius:170,electroneg:1.3,ionization:601},
 {z:98,sym:'Cf',name:'Kalifornioa',mass:251,val:[3],config:'[Rn] 5f10 7s2',group:'actinide',x:12,radius:186,electroneg:1.3,ionization:608},
 {z:99,sym:'Es',name:'Einsteinioa',mass:252,val:[3],config:'[Rn] 5f11 7s2',group:'actinide',x:13,radius:186,electroneg:1.3,ionization:619},
 {z:100,sym:'Fm',name:'Fermioa',mass:257,val:[3],config:'[Rn] 5f12 7s2',group:'actinide',x:14,radius:0,electroneg:1.3,ionization:627},
 {z:101,sym:'Md',name:'Mendelevioa',mass:258,val:[2,3],config:'[Rn] 5f13 7s2',group:'actinide',x:15,radius:0,electroneg:1.3,ionization:635},
 {z:102,sym:'No',name:'Nobelioa',mass:259,val:[2,3],config:'[Rn] 5f14 7s2',group:'actinide',x:16,radius:0,electroneg:1.3,ionization:642},
 {z:103,sym:'Lr',name:'Lawrentzioa',mass:266,val:[3],config:'[Rn] 5f14 7s2 7p1',group:'actinide',x:17,radius:0,electroneg:0,ionization:470}
];

const table = document.getElementById('table');
const lanthanidesContainer = document.getElementById('lanthanides');
const actinidesContainer = document.getElementById('actinides');
const searchInput = document.getElementById('searchInput');
const elecToggleBtn = document.getElementById('elecToggleBtn');
const elecLegend = document.getElementById('elecLegend');
const electronegToggleBtn = document.getElementById('electronegToggleBtn');
const electronegLegend = document.getElementById('electronegLegend');
const radiusToggleBtn = document.getElementById('radiusToggleBtn');
const radiusLegend = document.getElementById('radiusLegend');
const ionizationToggleBtn = document.getElementById('ionizationToggleBtn');
const ionizationLegend = document.getElementById('ionizationLegend');
const propertiesToggle = document.getElementById('propertiesToggle');
const trendArrows = document.getElementById('trendArrows');
const radiusTitle = document.querySelector('.radius-legend-title');
const electronegTitle = document.querySelector('.electroneg-legend-title');
const ionizationTitle = document.querySelector('.ionization-legend-title');

// NUEVO: Referencias para la funcionalidad 3D
const btn3D = document.getElementById('btn3D');
const modal3D = document.getElementById('modal3D');
const modal3DClose = document.getElementById('modal3DClose');
const canvas3D = document.getElementById('canvas3D');
const loading3D = document.getElementById('loading3D');
const info3D = document.getElementById('info3D');
const infoTitle = document.getElementById('infoTitle');
const infoDesc = document.getElementById('infoDesc');
const resetView = document.getElementById('resetView');
const autoRotate = document.getElementById('autoRotate');
const orbitalButtons = document.querySelectorAll('.modal-3d-orbital-btn');

// NUEVO: Referencias para los menús retráctiles
const categoryHeaders = document.querySelectorAll('.modal-3d-category-header');

// Store all cell elements for highlighting
let allCells = [];
let groupLabels = [];
let periodLabels = [];
let isElecConfigMode = false;
let isElectronegMode = false;
let isRadiusMode = false;
let isIonizationMode = false;

// NUEVO: Variables para la funcionalidad 3D
let currentModel = null;
let isAutoRotating = false;
let scene, camera, renderer, controls;
let orbitalModels = {};

// NUEVO: Información sobre los orbitales
const orbitalInfo = {
  's': {
    title: 's Orbitala',
    desc: 'Orbital esferikoa, simetria osoa du. Elektroi dentsitatea zentroan handiena da.'
  },
  'p': {
    title: 'p Orbitalak',
    desc: 'Orbital p guztien multzoa. Hiru orbital mota ditu: pₓ, pᵧ eta p₂, norabide bakoitzean orientatuak.'
  },
  'px': {
    title: 'pₓ Orbitala',
    desc: 'Orbital p bat, ardatz x-aren inguruan orientatuta. Bi lobulu ditu.'
  },
  'py': {
    title: 'pᵧ Orbitala',
    desc: 'Orbital p bat, ardatz y-aren inguruan orientatuta. Bi lobulu ditu.'
  },
  'pz': {
    title: 'p₂ Orbitala',
    desc: 'Orbital p bat, ardatz z-aren inguruan orientatuta. Bi lobulu ditu.'
  },
  'dxy': {
    title: 'dₓᵧ Orbitala',
    desc: 'Orbital d bat, ardatz x-y planoan kokatuta. Lau lobulu ditu.'
  },
  'dx2y2': {
    title: 'dₓ²₋ᵧ² Orbitala',
    desc: 'Orbital d bat, ardatz x eta y artean orientatuta. Lau lobulu ditu.'
  },
  'dyz': {
    title: 'dᵧ₂ Orbitala',
    desc: 'Orbital d bat, ardatz y-z planoan kokatuta. Lau lobulu ditu.'
  },
  'dzx': {
    title: 'd₂ₓ Orbitala',
    desc: 'Orbital d bat, ardatz z-x planoan kokatuta. Lau lobulu ditu.'
  },
  'dz2': {
    title: 'd₂² Orbitala',
    desc: 'Orbital d bat, ardatz z-aren inguruan orientatuta. Hiru lobulu ditu.'
  },
  'f1': {
    title: 'f₁ Orbitala',
    desc: 'Orbital f bat, konplexutasun handikoa. Zortzi lobulu ditu.'
  },
  'f2': {
    title: 'f₂ Orbitala',
    desc: 'Orbital f bat, konplexutasun handikoa. Zortzi lobulu ditu.'
  },
  'f3': {
    title: 'f₃ Orbitala',
    desc: 'Orbital f bat, konplexutasun handikoa. Zortzi lobulu ditu.'
  },
  'f4': {
    title: 'f₄ Orbitala',
    desc: 'Orbital f bat, konplexutasun handikoa. Zortzi lobulu ditu.'
  },
  'f5': {
    title: 'f₅ Orbitala',
    desc: 'Orbital f bat, konplexutasun handikoa. Zortzi lobulu ditu.'
  },
  'f6': {
    title: 'f₆ Orbitala',
    desc: 'Orbital f bat, konplexutasun handikoa. Zortzi lobulu ditu.'
  },
  'f7': {
    title: 'f₇ Orbitala',
    desc: 'Orbital f bat, konplexutasun handikoa. Zortzi lobulu ditu.'
  }
};

// NUEVO: Función para manejar los menús retráctiles
function initCollapsibleMenus() {
  categoryHeaders.forEach(header => {
    header.addEventListener('click', function() {
      const category = this.parentElement;
      category.classList.toggle('active');
    });
  });
}

// NUEVO: Inicializar el visualizador 3D
function init3DViewer() {
  // Crear escena
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0a0a0a);
  
  // Crear cámara
  camera = new THREE.PerspectiveCamera(75, canvas3D.clientWidth / canvas3D.clientHeight, 0.1, 1000);
  camera.position.z = 150;
  
  // Crear renderizador
  renderer = new THREE.WebGLRenderer({ 
    canvas: canvas3D, 
    antialias: true,
    alpha: true 
  });
  renderer.setSize(canvas3D.clientWidth, canvas3D.clientHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  
  // Controles de órbita
  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.05;
  
  // Iluminación
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(ambientLight);
  
  const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
  directionalLight.position.set(1, 1, 1);
  scene.add(directionalLight);
  
  // Ejes de referencia (opcional, para ayudar a la orientación)
  const axesHelper = new THREE.AxesHelper(2);
  scene.add(axesHelper);
  
  // Animación
  function animate() {
    requestAnimationFrame(animate);
    
    if (isAutoRotating && currentModel) {
      currentModel.rotation.y -= 0.005;
    }
    
    controls.update();
    renderer.render(scene, camera);
  }
  
  animate();
  
  // Manejar redimensionado
  window.addEventListener('resize', () => {
    camera.aspect = canvas3D.clientWidth / canvas3D.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(canvas3D.clientWidth, canvas3D.clientHeight);
  });
}

// NUEVO: Cargar modelo 3D
function loadOrbitalModel(modelName) {
  // Mostrar carga
  loading3D.style.display = 'block';
  info3D.style.display = 'none';
  
  // Limpiar modelo anterior
  if (currentModel) {
    scene.remove(currentModel);
    currentModel = null;
  }
  
  // Si ya tenemos el modelo cargado, usarlo
  if (orbitalModels[modelName]) {
    currentModel = orbitalModels[modelName].clone();
    scene.add(currentModel);
    loading3D.style.display = 'none';
    info3D.style.display = 'block';
    updateOrbitalInfo(modelName);
    return;
  }
  
  // URL del modelo (usando el repositorio proporcionado)
  const modelUrl = `https://raw.githubusercontent.com/Mikelikoptero/Taularako-argazkiak/main/Orbitalak2/${modelName}.glb`;
  
  // Cargar modelo usando GLTFLoader
  const loader = new THREE.GLTFLoader();
  
  loader.load(
    modelUrl,
    function(gltf) {
      const model = gltf.scene;
      
      // Ajustar escala y posición
      model.scale.set(1, 1, 1);
      model.position.set(0, 0, 0);
      
      // Añadir a la escena
      scene.add(model);
      currentModel = model;
      
      // Guardar en caché
      orbitalModels[modelName] = model.clone();
      
      // Ocultar carga y mostrar info
      loading3D.style.display = 'none';
      info3D.style.display = 'block';
      
      // Actualizar información
      updateOrbitalInfo(modelName);
    },
    function(xhr) {
      // Progreso de carga
      console.log((xhr.loaded / xhr.total * 100) + '% loaded');
    },
    function(error) {
      console.error('Error loading model:', error);
      loading3D.textContent = 'Errorea modelo kargatzean';
      
      // Crear una representación alternativa si falla la carga
      createAlternativeRepresentation(modelName);
    }
  );
}

// NUEVO: Crear representación alternativa si falla la carga del modelo
function createAlternativeRepresentation(modelName) {
  loading3D.style.display = 'none';
  info3D.style.display = 'block';
  
  let geometry, material;
  
  // Crear geometrías diferentes según el tipo de orbital
  if (modelName === 's') {
    geometry = new THREE.SphereGeometry(1, 32, 32);
    material = new THREE.MeshPhongMaterial({ 
      color: 0xff6b6b, 
      transparent: true, 
      opacity: 0.7,
      wireframe: true
    });
    currentModel = new THREE.Mesh(geometry, material);
  } else if (modelName.startsWith('p')) {
    geometry = new THREE.SphereGeometry(0.5, 16, 16);
    material = new THREE.MeshPhongMaterial({ 
      color: 0x6b8cff, 
      transparent: true, 
      opacity: 0.7,
      wireframe: true
    });
    
    // Crear dos esferas para representar los lobulos p
    const lobe1 = new THREE.Mesh(geometry, material);
    const lobe2 = new THREE.Mesh(geometry, material);
    
    if (modelName === 'px') {
      lobe1.position.x = 1.5;
      lobe2.position.x = -1.5;
    } else if (modelName === 'py') {
      lobe1.position.y = 1.5;
      lobe2.position.y = -1.5;
    } else if (modelName === 'pz') {
      lobe1.position.z = 1.5;
      lobe2.position.z = -1.5;
    }
    
    const group = new THREE.Group();
    group.add(lobe1);
    group.add(lobe2);
    currentModel = group;
  } else if (modelName.startsWith('d')) {
    geometry = new THREE.TorusGeometry(1, 0.3, 16, 32);
    material = new THREE.MeshPhongMaterial({ 
      color: 0x6bff8c, 
      transparent: true, 
      opacity: 0.7,
      wireframe: true
    });
    currentModel = new THREE.Mesh(geometry, material);
  } else {
    // Para orbitales f, usar una geometría más compleja
    geometry = new THREE.OctahedronGeometry(1, 1);
    material = new THREE.MeshPhongMaterial({ 
      color: 0xff8c6b, 
      transparent: true, 
      opacity: 0.7,
      wireframe: true
    });
    currentModel = new THREE.Mesh(geometry, material);
  }
  
  scene.add(currentModel);
  orbitalModels[modelName] = currentModel.clone();
  updateOrbitalInfo(modelName);
}

// NUEVO: Actualizar información del orbital
function updateOrbitalInfo(modelName) {
  const info = orbitalInfo[modelName] || {
    title: `${modelName} Orbitala`,
    desc: 'Orbital atomikoaren 3D errepresentazioa.'
  };
  
  infoTitle.textContent = info.title;
  infoDesc.textContent = info.desc;
}

// NUEVO: Event listeners para la funcionalidad 3D
btn3D.addEventListener('click', () => {
  modal3D.classList.add('active');
  // Inicializar el visualizador si es la primera vez
  if (!renderer) {
    init3DViewer();
  }
  // Inicializar menús retráctiles
  initCollapsibleMenus();
});

modal3DClose.addEventListener('click', () => {
  modal3D.classList.remove('active');
});

resetView.addEventListener('click', () => {
  if (controls) {
    controls.reset();
  }
});

autoRotate.addEventListener('click', () => {
  isAutoRotating = !isAutoRotating;
  autoRotate.textContent = isAutoRotating ? '⏸' : '▶';
});

orbitalButtons.forEach(button => {
  button.addEventListener('click', () => {
    // Remover clase activa de todos los botones
    orbitalButtons.forEach(btn => btn.classList.remove('active'));
    // Añadir clase activa al botón clickeado
    button.classList.add('active');
    
    // Cargar el modelo correspondiente
    const modelName = button.dataset.model;
    loadOrbitalModel(modelName);
  });
});

// El resto del código permanece igual...
// (manteniendo todas las funciones originales de la tabla periódica)

// Función para mostrar/ocultar las flechas de tendencia
function toggleTrendArrows(show, type) {
  const allArrows = trendArrows.querySelectorAll('.trend-arrow');
  
  allArrows.forEach(arrow => {
    arrow.style.display = 'none';
  });
  
  if (show) {
    const arrowsToShow = trendArrows.querySelectorAll(`.trend-arrow.${type}`);
    arrowsToShow.forEach(arrow => {
      arrow.style.display = 'block';
    });
    trendArrows.classList.add('active');
  } else {
    trendArrows.classList.remove('active');
  }
}

// Event listeners para las flechas de tendencia del radio atómico
radiusTitle.addEventListener('mouseenter', () => {
  toggleTrendArrows(true, 'radius');
});

radiusTitle.addEventListener('mouseleave', () => {
  toggleTrendArrows(false);
});

// Event listeners para las flechas de tendencia de la electronegatividad
electronegTitle.addEventListener('mouseenter', () => {
  toggleTrendArrows(true, 'electroneg');
});

electronegTitle.addEventListener('mouseleave', () => {
  toggleTrendArrows(false);
});

// NUEVO: Event listeners para las flechas de tendencia de la ionizazio energia
ionizationTitle.addEventListener('mouseenter', () => {
  toggleTrendArrows(true, 'ionization');
});

ionizationTitle.addEventListener('mouseleave', () => {
  toggleTrendArrows(false);
});

// Función para mostrar/ocultar la pestaña de propiedades
propertiesToggle.addEventListener('click', function(e) {
  // Solo activar/desactivar si se hace clic en el header, no en los toggles internos
  if (e.target.closest('.properties-header') || e.target === this) {
    this.classList.toggle('active');
  }
});

// Función para calcular el color basado en la electronegatividad
function getElectronegColor(electroneg, minElectroneg, maxElectroneg) {
  if (electroneg === 0) return '#e6f3ff'; // Color por defecto para datos faltantes
  
  // Normalizar la electronegatividad entre 0 y 1
  const normalized = (electroneg - minElectroneg) / (maxElectroneg - minElectroneg);
  
  // Crear gradiente de azul (más claro para electronegatividad baja, más oscuro para alta)
  const hue = 210; // Azul
  const saturation = 80;
  const lightness = 90 - (normalized * 40); // De 90% (muy claro) a 50% (oscuro)
  
  return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}

// Función para aplicar colores por electronegatividad
function applyElectronegativityColors() {
  // Encontrar electronegatividades mínimas y máximas
  let minElectroneg = Infinity;
  let maxElectroneg = 0;
  
  // Buscar en todos los elementos
  elements.forEach(el => {
    if (el.electroneg > 0) {
      if (el.electroneg < minElectroneg) minElectroneg = el.electroneg;
      if (el.electroneg > maxElectroneg) maxElectroneg = el.electroneg;
    }
  });
  
  lanthanides.forEach(el => {
    if (el.electroneg > 0) {
      if (el.electroneg < minElectroneg) minElectroneg = el.electroneg;
      if (el.electroneg > maxElectroneg) maxElectroneg = el.electroneg;
    }
  });
  
  actinides.forEach(el => {
    if (el.electroneg > 0) {
      if (el.electroneg < minElectroneg) minElectroneg = el.electroneg;
      if (el.electroneg > maxElectroneg) maxElectroneg = el.electroneg;
    }
  });
  
  allCells.forEach(cell => {
    const z = parseInt(cell.dataset.z);
    let element;
    
    // Encontrar el elemento en el conjunto de datos apropiado
    if (z >= 57 && z <= 71) {
      element = lanthanides.find(el => el.z === z);
    } else if (z >= 89 && z <= 103) {
      element = actinides.find(el => el.z === z);
    } else {
      element = elements.find(el => el.z === z);
    }
    
    if (element) {
      const electronegColor = getElectronegColor(element.electroneg, minElectroneg, maxElectroneg);
      
      // Aplicar color de electronegatividad
      cell.style.background = electronegColor;
      cell.classList.add('electronegativity');
      
      // Aplicar clase difuminada si la electronegatividad es 0 (SOLO cuando está activo el modo electronegatividad)
      if (element.electroneg === 0) {
        cell.classList.add('unknown-electroneg');
      } else {
        cell.classList.remove('unknown-electroneg');
      }
    }
  });
  
  // Activar toggle y leyenda
  electronegToggleBtn.classList.add('active');
  electronegLegend.classList.add('active');
  isElectronegMode = true;
}

// Función para calcular el color basado en el radio atómico
function getRadiusColor(radius, minRadius, maxRadius) {
  if (radius === 0) return '#e8f5e8'; // Color por defecto para datos faltantes
  
  // Normalizar el radio entre 0 y 1
  const normalized = (radius - minRadius) / (maxRadius - minRadius);
  
  // Crear gradiente de verde (más claro para radios pequeños, más oscuro para radios grandes)
  const hue = 120; // Verde
  const saturation = 70;
  const lightness = 90 - (normalized * 40); // De 90% (muy claro) a 50% (oscuro)
  
  return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}

// Función para aplicar colores por radio atómico
function applyAtomicRadiusColors() {
  // Encontrar radios mínimos y máximos
  let minRadius = Infinity;
  let maxRadius = 0;
  
  // Buscar en todos los elementos
  elements.forEach(el => {
    if (el.radius > 0) {
      if (el.radius < minRadius) minRadius = el.radius;
      if (el.radius > maxRadius) maxRadius = el.radius;
    }
  });
  
  lanthanides.forEach(el => {
    if (el.radius > 0) {
      if (el.radius < minRadius) minRadius = el.radius;
      if (el.radius > maxRadius) maxRadius = el.radius;
    }
  });
  
  actinides.forEach(el => {
    if (el.radius > 0) {
      if (el.radius < minRadius) minRadius = el.radius;
      if (el.radius > maxRadius) maxRadius = el.radius;
    }
  });
  
  allCells.forEach(cell => {
    const z = parseInt(cell.dataset.z);
    let element;
    
    // Encontrar el elemento en el conjunto de datos apropiado
    if (z >= 57 && z <= 71) {
      element = lanthanides.find(el => el.z === z);
    } else if (z >= 89 && z <= 103) {
      element = actinides.find(el => el.z === z);
    } else {
      element = elements.find(el => el.z === z);
    }
    
    if (element) {
      const radiusColor = getRadiusColor(element.radius, minRadius, maxRadius);
      
      // Aplicar color de radio atómico
      cell.style.background = radiusColor;
      cell.classList.add('atomic-radius');
      
      // Aplicar clase difuminada si el radio es 0 (SOLO cuando está activo el modo radio)
      if (element.radius === 0) {
        cell.classList.add('unknown-radius');
      } else {
        cell.classList.remove('unknown-radius');
      }
    }
  });
  
  // Activar toggle y leyenda
  radiusToggleBtn.classList.add('active');
  radiusLegend.classList.add('active');
  isRadiusMode = true;
}

// NUEVO: Función para calcular el color basado en la ionizazio energia
function getIonizationColor(ionization, minIonization, maxIonization) {
  if (ionization === 0) return '#ffe6e6'; // Color por defecto para datos faltantes
  
  // Normalizar la ionizazio energia entre 0 y 1
  const normalized = (ionization - minIonization) / (maxIonization - minIonization);
  
  // Crear gradiente de rojo (más claro para ionizazio energia baja, más oscuro para alta)
  const hue = 0; // Rojo
  const saturation = 80;
  const lightness = 90 - (normalized * 40); // De 90% (muy claro) a 50% (oscuro)
  
  return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}

// NUEVO: Función para aplicar colores por ionizazio energia
function applyIonizationColors() {
  // Encontrar ionizazio energias mínimas y máximas
  let minIonization = Infinity;
  let maxIonization = 0;
  
  // Buscar en todos los elementos
  elements.forEach(el => {
    if (el.ionization > 0) {
      if (el.ionization < minIonization) minIonization = el.ionization;
      if (el.ionization > maxIonization) maxIonization = el.ionization;
    }
  });
  
  lanthanides.forEach(el => {
    if (el.ionization > 0) {
      if (el.ionization < minIonization) minIonization = el.ionization;
      if (el.ionization > maxIonization) maxIonization = el.ionization;
    }
  });
  
  actinides.forEach(el => {
    if (el.ionization > 0) {
      if (el.ionization < minIonization) minIonization = el.ionization;
      if (el.ionization > maxIonization) maxIonization = el.ionization;
    }
  });
  
  allCells.forEach(cell => {
    const z = parseInt(cell.dataset.z);
    let element;
    
    // Encontrar el elemento en el conjunto de datos apropiado
    if (z >= 57 && z <= 71) {
      element = lanthanides.find(el => el.z === z);
    } else if (z >= 89 && z <= 103) {
      element = actinides.find(el => el.z === z);
    } else {
      element = elements.find(el => el.z === z);
    }
    
    if (element) {
      const ionizationColor = getIonizationColor(element.ionization, minIonization, maxIonization);
      
      // Aplicar color de ionizazio energia
      cell.style.background = ionizationColor;
      cell.classList.add('ionization-energy');
      
      // Aplicar clase difuminada si la ionizazio energia es 0 (SOLO cuando está activo el modo ionizazio)
      if (element.ionization === 0) {
        cell.classList.add('unknown-ionization');
      } else {
        cell.classList.remove('unknown-ionization');
      }
    }
  });
  
  // Activar toggle y leyenda
  ionizationToggleBtn.classList.add('active');
  ionizationLegend.classList.add('active');
  isIonizationMode = true;
}

// Función para restaurar colores originales
function restoreOriginalColors() {
  allCells.forEach(cell => {
    // Remover clases de bloque, electronegatividad, radio atómico y ionizazio energia
    cell.classList.remove('s-block', 'p-block', 'd-block', 'f-block', 'electronegativity', 'atomic-radius', 'ionization-energy', 'unknown-radius', 'unknown-electroneg', 'unknown-ionization');
    
    // Restaurar color original basado en grupo
    const group = cell.dataset.group;
    cell.style.background = ''; // Remover colores especiales
  });
  
  // Desactivar toggles y leyendas
  elecToggleBtn.classList.remove('active');
  elecLegend.classList.remove('active');
  electronegToggleBtn.classList.remove('active');
  electronegLegend.classList.remove('active');
  radiusToggleBtn.classList.remove('active');
  radiusLegend.classList.remove('active');
  ionizationToggleBtn.classList.remove('active');
  ionizationLegend.classList.remove('active');
  isElecConfigMode = false;
  isElectronegMode = false;
  isRadiusMode = false;
  isIonizationMode = false;
}

// Función CORREGIDA para determinar el bloque electrónico de un elemento
function getElectronBlock(element) {
  const group = element.x;
  
  // Excepción: Helio es bloque s aunque esté en el grupo 18
  if (element.z === 2) return 's-block';
  
  // CORRECCIÓN: Lutenio (Lu) y Laurencio (Lr) son del bloque d
  if (element.z === 71 || element.z === 103) return 'd-block';
  
  // Basado en la posición en la tabla periódica
  if (element.group === 'lanthanide' || element.group === 'actinide') {
    return 'f-block';
  } else if (group >= 3 && group <= 12) {
    return 'd-block';
  } else if (group >= 13 && group <= 18) {
    return 'p-block';
  } else if (group >= 1 && group <= 2) {
    return 's-block';
  }
  
  return 's-block'; // default
}

// Función para aplicar colores por bloques electrónicos
function applyElectronBlockColors() {
  allCells.forEach(cell => {
    const z = parseInt(cell.dataset.z);
    let element;
    
    // Encontrar el elemento en el conjunto de datos apropiado
    if (z >= 57 && z <= 71) {
      element = lanthanides.find(el => el.z === z);
    } else if (z >= 89 && z <= 103) {
      element = actinides.find(el => el.z === z);
    } else {
      element = elements.find(el => el.z === z);
    }
    
    if (element) {
      const block = getElectronBlock(element);
      
      // Remover clases de bloque anteriores y otros modos
      cell.classList.remove('s-block', 'p-block', 'd-block', 'f-block', 'electronegativity', 'atomic-radius', 'ionization-energy', 'unknown-radius', 'unknown-electroneg', 'unknown-ionization');
      cell.style.background = ''; // Remover colores especiales
      
      // Aplicar nueva clase de bloque
      cell.classList.add(block);
    }
  });
  
  // Activar toggle y leyenda
  elecToggleBtn.classList.add('active');
  elecLegend.classList.add('active');
  isElecConfigMode = true;
  isElectronegMode = false;
  isRadiusMode = false;
  isIonizationMode = false;
}

// Event listener para el botón de toggle de orbitales
elecToggleBtn.addEventListener('click', function(e) {
  e.stopPropagation(); // Prevenir que el evento se propague al contenedor de propiedades
  if (isElecConfigMode) {
    restoreOriginalColors();
  } else {
    applyElectronBlockColors();
  }
});

// Event listener para el botón de toggle de electronegatividad
electronegToggleBtn.addEventListener('click', function(e) {
  e.stopPropagation(); // Prevenir que el evento se propague al contenedor de propiedades
  if (isElectronegMode) {
    restoreOriginalColors();
  } else {
    applyElectronegativityColors();
  }
});

// Event listener para el botón de toggle de radio atómico
radiusToggleBtn.addEventListener('click', function(e) {
  e.stopPropagation(); // Prevenir que el evento se propague al contenedor de propiedades
  if (isRadiusMode) {
    restoreOriginalColors();
  } else {
    applyAtomicRadiusColors();
  }
});

// NUEVO: Event listener para el botón de toggle de ionizazio energia
ionizationToggleBtn.addEventListener('click', function(e) {
  e.stopPropagation(); // Prevenir que el evento se propague al contenedor de propiedades
  if (isIonizationMode) {
    restoreOriginalColors();
  } else {
    applyIonizationColors();
  }
});

// Search functionality
searchInput.addEventListener('input', function() {
  const searchTerm = this.value.toLowerCase().trim();
  
  allCells.forEach(cell => {
    const z = parseInt(cell.dataset.z);
    let element;
    
    // Find the element in the appropriate dataset
    if (z >= 57 && z <= 71) {
      element = lanthanides.find(el => el.z === z);
    } else if (z >= 89 && z <= 103) {
      element = actinides.find(el => el.z === z);
    } else {
      element = elements.find(el => el.z === z);
    }
    
    if (element) {
      const matches = element.name.toLowerCase().includes(searchTerm) ||
                     element.sym.toLowerCase().includes(searchTerm) ||
                     element.z.toString().includes(searchTerm);
      
      // Remove previous search classes
      cell.classList.remove('search-match', 'search-nomatch');
      
      if (searchTerm === '') {
        // No search term - show all normally
        cell.style.opacity = '';
        cell.style.filter = '';
        cell.style.transform = '';
        cell.style.border = '';
      } else if (matches) {
        // Match found - highlight it
        cell.classList.add('search-match');
      } else {
        // No match - dim it
        cell.classList.add('search-nomatch');
      }
    }
  });
});

// Zoom functionality
let zoomLevel = 1;
const minZoom = 0.5;
const maxZoom = 2;
const zoomStep = 0.05;

function updateZoom() {
  document.documentElement.style.setProperty('--zoom-level', zoomLevel);
  document.getElementById('zoomLevel').textContent = Math.round(zoomLevel * 100) + '%';
}

document.getElementById('zoomIn').addEventListener('click', () => {
  if (zoomLevel < maxZoom) {
    zoomLevel += zoomStep;
    updateZoom();
  }
});

document.getElementById('zoomOut').addEventListener('click', () => {
  if (zoomLevel > minZoom) {
    zoomLevel -= zoomStep;
    updateZoom();
  }
});

document.getElementById('zoomReset').addEventListener('click', () => {
  zoomLevel = 1;
  updateZoom();
});

// create grid placeholders to preserve spacing
for(let r=1;r<=7;r++){
  for(let c=1;c<=18;c++){
    const ph = document.createElement('div');
    ph.style.gridColumn=c;
    ph.style.gridRow=r;
    ph.style.visibility='hidden';
    table.appendChild(ph);
  }
}

// Add placeholder cells for 57-71 and 89-103
function createPlaceholderCell(text, column, row) {
  const placeholder = document.createElement('div');
  placeholder.className = 'placeholder-cell';
  placeholder.style.gridColumn = column;
  placeholder.style.gridRow = row;
  placeholder.textContent = text;
  table.appendChild(placeholder);
}

// Create placeholders for lanthanides and actinides in main table
createPlaceholderCell('57-71', 3, 6);
createPlaceholderCell('89-103', 3, 7);

// Create table legend with hover functionality
function createTableLegend() {
  const legend = document.createElement('div');
  legend.className = 'table-legend';
  
  const legendItems = [
    {color: '#FFB6C1', text: 'Metal Alkalinoak', group: 'alkali'},
    {color: '#FFD8B1', text: 'Metal Lurralkalinoak', group: 'alkaline'},
    {color: '#B0E0E6', text: 'Trantsizio Metalak', group: 'transition'},
    {color: '#E6E6FA', text: 'Beste metalak', group: 'post-transition'},
    {color: '#98FB98', text: 'Metaloideak', group: 'metalloid'},
    {color: '#F0E68C', text: 'Ez-metalak', group: 'nonmetal'},
    {color: '#FFDEAD', text: 'Halogenoak', group: 'halogen'},
    {color: '#DDA0DD', text: 'Gas nobleak', group: 'noble'},
    {color: '#C9E4DE', text: 'Lantanoideak', group: 'lanthanide'},
    {color: '#D8BFD8', text: 'Aktinoideak', group: 'actinide'}
  ];

  legendItems.forEach(item => {
    const legendItem = document.createElement('div');
    legendItem.className = 'table-legend-item';
    legendItem.dataset.group = item.group;
    legendItem.innerHTML = `
      <div class="sw" style="background:${item.color}"></div>
      <span>${item.text}</span>
    `;
    
    // Add hover events
    legendItem.addEventListener('mouseenter', () => highlightGroup(item.group, legendItem));
    legendItem.addEventListener('mouseleave', () => removeHighlight(legendItem));
    
    legend.appendChild(legendItem);
  });

  table.appendChild(legend);
}

// Highlight elements of a specific group
function highlightGroup(group, legendItem) {
  // Add active class to legend item
  legendItem.classList.add('active');
  
  // Highlight matching cells and dim others
  allCells.forEach(cell => {
    if (cell.classList.contains(group)) {
      cell.classList.add('highlighted');
    } else {
      cell.classList.add('dimmed');
    }
  });
}

// Remove highlighting
function removeHighlight(legendItem) {
  // Remove active class from legend item
  legendItem.classList.remove('active');
  
  // Remove highlighting from all cells
  allCells.forEach(cell => {
    cell.classList.remove('highlighted');
    cell.classList.remove('dimmed');
  });
}

function groupClass(g){
  switch(g){
    case 'alkali': return 'alkali';
    case 'alkaline': return 'alkaline';
    case 'lanthanide': return 'lanthanide';
    case 'actinide': return 'actinide';
    case 'transition': return 'transition';
    case 'post-transition': return 'post-transition';
    case 'metalloid': return 'metalloid';
    case 'nonmetal': return 'nonmetal';
    case 'halogen': return 'halogen';
    case 'noble': return 'noble';
    default: return 'other';
  }
}

// MODIFICADO: Función para destacar grupo y periodo - NO destacar grupo para lantánidos y actínidos
function highlightGroupAndPeriod(group, period, isLanthanideOrActinide = false) {
  // Remove previous highlights
  removeGroupAndPeriodHighlights();
  
  // Solo destacar grupo si NO es un lantánido o actínido
  if (!isLanthanideOrActinide && group >= 1 && group <= 18) {
    const groupLabel = groupLabels[group - 1];
    if (groupLabel) {
      groupLabel.classList.add('highlighted');
    }
  }
  
  // Destacar periodo siempre (lantánidos son periodo 6, actínidos periodo 7)
  if (period >= 1 && period <= 7) {
    const periodLabel = periodLabels[period - 1];
    if (periodLabel) {
      periodLabel.classList.add('highlighted');
    }
  }
}

// Function to remove group and period highlights
function removeGroupAndPeriodHighlights() {
  groupLabels.forEach(label => label.classList.remove('highlighted'));
  periodLabels.forEach(label => label.classList.remove('highlighted'));
}

// place main table elements
elements.forEach(el=>{
  const d = document.createElement('div');
  d.className = 'cell ' + groupClass(el.group);
  d.style.gridColumn = el.x;
  d.style.gridRow = el.y;
  d.dataset.z = el.z;
  d.dataset.group = el.group;
  d.dataset.period = el.y;
  d.innerHTML = `<div style="display:flex;justify-content:space-between"><div class='num'>${el.z}</div></div><div style="text-align:center;margin-top:4px"><div class='sym'>${el.sym}</div><div class='ename'>${el.name}</div></div>`;
  
  // NOTA: No aplicar clases unknown aquí - solo se aplicarán cuando se activen los modos correspondientes
  
  // Add mouse events for highlighting group and period
  d.addEventListener('mouseenter', () => {
    highlightGroupAndPeriod(el.x, el.y, false); // No son lantánidos/actínidos
  });
  
  d.addEventListener('mouseleave', () => {
    removeGroupAndPeriodHighlights();
  });
  
  d.addEventListener('click', ()=> show(el,d));
  table.appendChild(d);
  allCells.push(d);
});

// Create table legend
createTableLegend();

// place lanthanides (including La) - CORREGIDO: Los elementos empiezan en columna 1 del contenedor
lanthanides.forEach((el, index)=>{
  const d = document.createElement('div');
  d.className = 'cell ' + groupClass(el.group);
  // CORRECCIÓN: Restar 2 para que empiece en columna 1 (3-2=1, 4-2=2, etc.)
  d.style.gridColumn = el.x - 2;
  d.dataset.z = el.z;
  d.dataset.group = el.group;
  d.dataset.period = 6; // Lanthanides are in period 6
  d.innerHTML = `<div style="display:flex;justify-content:space-between"><div class='num'>${el.z}</div></div><div style="text-align:center;margin-top:4px"><div class='sym'>${el.sym}</div><div class='ename'>${el.name}</div></div>`;
  
  // NOTA: No aplicar clases unknown aquí - solo se aplicarán cuando se activen los modos correspondientes
  
  // MODIFICADO: Add mouse events for highlighting ONLY period (not group)
  d.addEventListener('mouseenter', () => {
    highlightGroupAndPeriod(el.x, 6, true); // Son lantánidos
  });
  
  d.addEventListener('mouseleave', () => {
    removeGroupAndPeriodHighlights();
  });
  
  d.addEventListener('click', ()=> show(el,d));
  lanthanidesContainer.appendChild(d);
  allCells.push(d);
});

// place actinides (including Ac) - CORREGIDO: Los elementos empiezan en columna 1 del contenedor
actinides.forEach((el, index)=>{
  const d = document.createElement('div');
  d.className = 'cell ' + groupClass(el.group);
  // CORRECCIÓN: Restar 2 para que empiece en columna 1 (3-2=1, 4-2=2, etc.)
  d.style.gridColumn = el.x - 2;
  d.dataset.z = el.z;
  d.dataset.group = el.group;
  d.dataset.period = 7; // Actinides are in period 7
  d.innerHTML = `<div style="display:flex;justify-content:space-between"><div class='num'>${el.z}</div></div><div style="text-align:center;margin-top:4px"><div class='sym'>${el.sym}</div><div class='ename'>${el.name}</div></div>`;
  
  // NOTA: No aplicar clases unknown aquí - solo se aplicarán cuando se activen los modos correspondientes
  
  // MODIFICADO: Add mouse events for highlighting ONLY period (not group)
  d.addEventListener('mouseenter', () => {
    highlightGroupAndPeriod(el.x, 7, true); // Son actínidos
  });
  
  d.addEventListener('mouseleave', () => {
    removeGroupAndPeriodHighlights();
  });
  
  d.addEventListener('click', ()=> show(el,d));
  actinidesContainer.appendChild(d);
  allCells.push(d);
});

// Initialize group and period labels
function initLabels() {
  // Get group labels
  const groupsContainer = document.querySelector('.groups-container');
  groupLabels = Array.from(groupsContainer.querySelectorAll('.group-label'));
  
  // Get period labels
  const periodsColumn = document.querySelector('.periods-column');
  periodLabels = Array.from(periodsColumn.querySelectorAll('.period-label'));
}

// show info in panel - MODIFICADO: Estructura simplificada
function show(el,cell){
  const icon = document.getElementById('iconSquare');
  const title = document.getElementById('titleMain');
  const subtitle = document.getElementById('subtitle');
  
  // Actualizar información básica
  title.textContent = el.name;
  subtitle.textContent = `Z = ${el.z}`;
  
  // Actualizar lista de datos importantes
  document.getElementById('iz').textContent = el.z;
  document.getElementById('imass').textContent = el.mass ? el.mass + ' u' : '—';
  document.getElementById('ival').textContent = (el.val && el.val.length)? el.val.join(', '): '—';
  document.getElementById('iconfig').textContent = el.config || '—';
  
  // Mostrar electronegatividad
  const electronegDisplay = document.getElementById('ielectroneg');
  if (el.electroneg && el.electroneg > 0) {
    electronegDisplay.textContent = el.electroneg.toFixed(2);
  } else {
    electronegDisplay.textContent = 'Ezezaguna';
  }
  
  // Mostrar radio atómico
  const radiusDisplay = document.getElementById('iradius');
  if (el.radius && el.radius > 0) {
    radiusDisplay.textContent = el.radius + ' pm';
  } else {
    radiusDisplay.textContent = 'Ezezaguna';
  }
  
  // NUEVO: Mostrar ionizazio energia
  const ionizationDisplay = document.getElementById('iionization');
  if (el.ionization && el.ionization > 0) {
    ionizationDisplay.textContent = el.ionization + ' kJ/mol';
  } else {
    ionizationDisplay.textContent = 'Ezezaguna';
  }
  
  // set icon square color same as cell
  const style = window.getComputedStyle(cell);
  icon.style.background = style.backgroundColor || '#222';
  icon.textContent = el.sym;
}

// initialize
initLabels();
show(elements[0], document.querySelector('.cell'));
updateZoom();

// Ocultar todas las flechas inicialmente
toggleTrendArrows(false);
</script>
</body>
</html>